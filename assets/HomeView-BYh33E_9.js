var ne=Object.defineProperty;var oe=(s,t,e)=>t in s?ne(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var j=(s,t,e)=>(oe(s,typeof t!="symbol"?t+"":t,e),e);import{d as U,r as w,w as Y,c as L,a as I,b as k,o as v,e as c,t as C,f as b,g,n as z,h as Q,u as D,i as M,j as A,F as B,k as E,l as le,m as X,p as Z,q as ee}from"./index-DY88eTzZ.js";const ae={class:"font-bold mb-2"},re={class:"p-fluid"},q=U({__name:"ConfirmModal",props:{visible:{type:Boolean},header:{},message:{}},emits:["confirm","cancel"],setup(s,{emit:t}){const e=s,o=t,n=w(e.visible);return Y(e,()=>{n.value=e.visible}),(a,u)=>{const m=k("Button"),h=k("Dialog");return v(),L(h,{visible:n.value,"onUpdate:visible":u[2]||(u[2]=r=>n.value=r),modal:"",header:e.header,onHide:u[3]||(u[3]=r=>o("cancel"))},{default:I(()=>[c("div",ae,C(e.message),1),c("div",re,[b(m,{class:"mb-2",type:"button",label:"Yes",onClick:u[0]||(u[0]=r=>o("confirm"))}),b(m,{type:"button",label:"No",severity:"secondary",onClick:u[1]||(u[1]=r=>o("cancel"))})])]),_:1},8,["visible","header"])}}}),ie={key:1},ue=U({__name:"ScoreCell",props:{result:{}},emits:["showResultModal"],setup(s,{emit:t}){const e=s,o=t,n=a=>a.finishTime?"bg-primary":a.startTime?"in-progress":"bg-cyan-100";return(a,u)=>(v(),g("div",{class:z(["p-2 text-center cursor-pointer border-round-md",n(e.result)]),onClick:u[0]||(u[0]=()=>o("showResultModal"))},[e.result.startTime?(v(),g("span",{key:0,class:z([e.result.finishTime&&"font-bold"])},C(e.result.scores.map(m=>m.score).join("-")),3)):(v(),g("span",ie," ?-? "))],2))}}),J=(s,t)=>{const e=s.__vccOpts||s;for(const[o,n]of t)e[o]=n;return e},ce=J(ue,[["__scopeId","data-v-a0880355"]]);let O;const de=new Uint8Array(16);function me(){if(!O&&(O=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!O))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return O(de)}const T=[];for(let s=0;s<256;++s)T.push((s+256).toString(16).slice(1));function pe(s,t=0){return T[s[t+0]]+T[s[t+1]]+T[s[t+2]]+T[s[t+3]]+"-"+T[s[t+4]]+T[s[t+5]]+"-"+T[s[t+6]]+T[s[t+7]]+"-"+T[s[t+8]]+T[s[t+9]]+"-"+T[s[t+10]]+T[s[t+11]]+T[s[t+12]]+T[s[t+13]]+T[s[t+14]]+T[s[t+15]]}const he=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),K={randomUUID:he};function te(s,t,e){if(K.randomUUID&&!t&&!s)return K.randomUUID();s=s||{};const o=s.random||(s.rng||me)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,t){e=e||0;for(let n=0;n<16;++n)t[e+n]=o[n];return t}return pe(o)}const H=Q("players",()=>{const s=w([]);return{players:s,init:n=>{s.value=n.map(a=>({id:te(),name:a}))},getName:n=>{var a;return((a=s.value.find(u=>u.id===n))==null?void 0:a.name)??n},clear:()=>s.value=[]}}),ve={class:"grid m-0"},fe={class:"col-5"},_e={class:"col-2 p-0"},be={class:"col-5 text-right"},ye=U({__name:"FixtureCard",props:{result:{}},emits:["showResultModal"],setup(s,{emit:t}){const e=s,o=t,n=H();return(a,u)=>(v(),g("div",ve,[c("div",fe,C(D(n).getName(e.result.scores[0].playerId)),1),c("div",_e,[b(ce,{result:e.result,onShowResultModal:u[0]||(u[0]=()=>o("showResultModal",e.result))},null,8,["result"])]),c("div",be,C(D(n).getName(e.result.scores[1].playerId)),1)]))}}),W=Q("rounds",()=>{const s=w([]),t=M(()=>s.value.flatMap(r=>r.fixtures)),e=M(()=>s.value.flatMap(r=>r.fixtures).filter(r=>!r.finishTime).length),o=M(()=>{const r=s.value.find(f=>f.fixtures.some(x=>!x.finishTime));return r?r.index:0}),n=r=>s.value.find(f=>f.fixtures.some(x=>x.id===r)),a=r=>s.value=r;return{rounds:s,results:t,remainingCount:e,currentRound:o,getRound:n,setRounds:a,startFixture:r=>{s.value=s.value.map(f=>f.startFixture(r))},updateResult:(r,f)=>{s.value=s.value.map(x=>x.updateResult(r,f))},clear:()=>a([])}}),ge={class:"flex flex-column md:flex-row md:align-items-center justify-content-between mb-2"},xe={class:"font-bold"},we={class:"flex flex-column md:flex-row md:align-items-center justify-content-between mb-2"},Re={class:"font-bold"},Se={class:"md:ml-3"},Te=c("span",{class:"pi pi-plus"},null,-1),$e=c("span",{class:"pi pi-minus"},null,-1),Ce={class:"p-fluid"},Fe=U({__name:"RecordResultModal",props:{visible:{type:Boolean},round:{},result:{},raceTo:{}},emits:["cancel","start","confirm"],setup(s,{emit:t}){const e=s,o=t,n=H(),a=W(),u=w(e.visible),m=w(e.result.scores.map(d=>d.playerId)),h=w(e.result.scores.map(d=>d.score));Y([h],()=>{var d;(d=document.activeElement)==null||d.blur()}),Y(e,()=>{u.value=e.visible,m.value=e.result.scores.map(d=>d.playerId),h.value=e.result.scores.map(d=>d.score)});const r=(d,_)=>{h.value=h.value.map((N,F)=>F===d?_:N)},f=()=>o("start"),x=d=>{const _={id:e.result.id,scores:m.value.map((N,F)=>({playerId:N,score:h.value[F]})),startTime:e.result.startTime};o("confirm",_,d)},S=M(()=>e.round.index>a.currentRound?"Waiting for round to start":"Start"),l=M(()=>e.round.index>a.currentRound),p=M(()=>!!([...new Set(m.value)].length!==m.value.length||h.value.every(_=>_<e.raceTo))),i=M(()=>e.result.scores.map(d=>n.getName(d.playerId)).join(" v ")),y=M(()=>`${e.round.name} - ${i.value}`);return(d,_)=>{const N=k("InputNumber"),F=k("Button"),$=k("Dialog");return v(),L($,{visible:u.value,"onUpdate:visible":_[3]||(_[3]=R=>u.value=R),modal:"",header:y.value,onHide:_[4]||(_[4]=R=>o("cancel"))},{default:I(()=>[e.result.finishTime?(v(!0),g(B,{key:0},A(m.value,(R,V)=>(v(),g("div",ge,[c("div",xe,C(D(n).getName(R))+": "+C(h.value[V]),1)]))),256)):e.result.startTime?(v(!0),g(B,{key:1},A(m.value,(R,V)=>(v(),g("div",we,[c("div",Re,C(D(n).getName(R)),1),c("div",Se,[b(N,{showButtons:"",buttonLayout:"horizontal",modelValue:h.value[V],min:0,max:e.raceTo,"onUpdate:modelValue":P=>r(V,P)},{incrementbuttonicon:I(()=>[Te]),decrementbuttonicon:I(()=>[$e]),_:2},1032,["modelValue","max","onUpdate:modelValue"])])]))),256)):E("",!0),c("div",Ce,[e.result.startTime?E("",!0):(v(),L(F,{key:0,class:"mb-2",type:"button",label:S.value,disabled:l.value,onClick:f},null,8,["label","disabled"])),e.result.startTime&&!e.result.finishTime?(v(),L(F,{key:1,class:"mb-2",type:"button",label:"Update",severity:"info",onClick:_[0]||(_[0]=()=>x(!1))})):E("",!0),e.result.startTime&&!e.result.finishTime?(v(),L(F,{key:2,class:"mb-2",type:"button",label:"Finish",disabled:p.value,onClick:_[1]||(_[1]=()=>x(!0))},null,8,["disabled"])):E("",!0),b(F,{type:"button",label:"Close",severity:"secondary",onClick:_[2]||(_[2]=R=>o("cancel"))})])]),_:1},8,["visible","header"])}}}),Ie={class:"flex flex-column md:flex-row justify-content-between md:align-items-end border-bottom-1 pb-1"},Me=c("h1",null,"Fixtures",-1),ke={class:"text-center"},Ve=U({__name:"FixtureList",props:{raceTo:{}},setup(s){const t=s,e=W(),o=M(()=>{var f;return e.getRound(((f=n.value)==null?void 0:f.id)||"")}),n=w(),a=w(!1),u=f=>{n.value=f,a.value=!0},m=()=>{n.value&&(e.startFixture(n.value.id),r())},h=(f,x)=>{e.updateResult(f,x),r()},r=()=>{a.value=!1};return(f,x)=>(v(),g(B,null,[c("div",Ie,[Me,c("h4",null,"Results remaining: "+C(D(e).remainingCount),1)]),(v(!0),g(B,null,A(D(e).rounds,(S,l)=>(v(),g("div",{class:z([l>0&&"border border-top-1"])},[c("h3",ke,C(S.name),1),(v(!0),g(B,null,A(S.fixtures,(p,i)=>(v(),g("div",{class:z(["mt-1 pt-1 mb-1",[i>0&&"border-gray-200 border-top-1"]])},[b(ye,{result:p,onShowResultModal:()=>u(p)},null,8,["result","onShowResultModal"])],2))),256))],2))),256)),o.value&&n.value?(v(),L(Fe,{key:0,visible:a.value,round:o.value,result:n.value,raceTo:t.raceTo,onStart:m,onConfirm:h,onCancel:r},null,8,["visible","round","result","raceTo"])):E("",!0)],64))}}),Ne={class:"player-name-input p-fluid"},Be=U({__name:"PlayerNameInput",props:{name:{},placeholder:{},disabled:{type:Boolean}},emits:["setName"],setup(s,{emit:t}){const e=s,o=t;return(n,a)=>{const u=k("InputText");return v(),g("div",Ne,[b(u,{placeholder:e.placeholder,disabled:e.disabled,modelValue:e.name,"onUpdate:modelValue":a[0]||(a[0]=m=>o("setName",m||""))},null,8,["placeholder","disabled","modelValue"])])}}});class G{constructor(t){j(this,"frameTimeEstimateMins",7);j(this,"generatedRounds");this.players=t}estimateDuration(t,e,o){const n=t*(t-1)/2,a=2*e-1,u=(e+a)/2,m=n*u;return Math.ceil(this.frameTimeEstimateMins*m/o)}generateFixtures(){if(this.generatedRounds!==void 0)throw"Fixtures have already been generated!";let t=0;const e=this.players.length%2!==0,o=e?this.players.length:this.players.length-1;this.generatedRounds=[];const n=this.shuffle(this.players.map((u,m)=>m));let a=0;for(;a<o&&t<10;){const u=new De(a+1,"Round "+(a+1));console.log(u.name);let m=!1,h=[...this.players];for(e&&(console.log("Omitting: "+h[n[a]].name),h.splice(n[a],1));h.length>1;){const r=this.getRandom(h),f=this.generatedRounds.flatMap(l=>l.getExistingOpponents(r)),x=h.filter(l=>!f.includes(l.id)&&r.id!==l.id);if(x.length<=0){console.log("Retrying round..."),m=!0;break}const S=this.getRandom(x);u.addFixture([r,S]),h=h.filter(l=>![r.id,S.id].includes(l.id))}if(m){t++;continue}this.generatedRounds.push(u),a++}return t>=10&&console.log("Failed to generate rounds after 10 attempts!"),this.generatedRounds}getCurrentRound(){if(this.generatedRounds===void 0)return 0;const t=this.generatedRounds.find(e=>e.fixtures.some(o=>!o.finishTime));return t?t.index:0}getRandom(t){return t[Math.floor(Math.random()*t.length)]}shuffle(t){let e=t.length,o=0;for(;e>0;){o=Math.floor(Math.random()*e),e--;const n=t[e];t[e]=t[o],t[o]=n}return t}}class De{constructor(t,e){j(this,"index");j(this,"name");j(this,"fixtures");this.index=t,this.name=e,this.fixtures=[]}addFixture(t){console.log(t.map(e=>e.name).join(" v ")),this.fixtures.push({id:te(),scores:t.map(e=>({playerId:e.id,score:0})),startTime:null,finishTime:null})}startFixture(t){const e=this.fixtures.findIndex(o=>o.id===t);return e>=0&&(this.fixtures[e].startTime=Date.now()),this}updateResult(t,e){const o=this.fixtures.findIndex(n=>n.id===t.id);return o>=0&&(e&&(t.finishTime=Date.now()),this.fixtures[o]=t),this}getExistingFixtures(t){return this.fixtures.filter(e=>e.scores.some(o=>o.playerId===t.id))}getExistingOpponents(t){const e=this.getExistingFixtures(t);return[...new Set(e.map(o=>o.scores.map(n=>n.playerId).filter(n=>n!==t.id)).flatMap(o=>o))]}}const Ue=c("h1",{class:"border-bottom-1 mb-2"},"Format",-1),Pe={class:"p-fluid mb-2"},Ee=c("span",{class:"pi pi-plus"},null,-1),Le=c("span",{class:"pi pi-minus"},null,-1),je={class:"p-fluid mb-2"},Ae=c("span",{class:"pi pi-plus"},null,-1),Oe=c("span",{class:"pi pi-minus"},null,-1),ze={class:"p-fluid mb-2"},He={class:"p-fluid mb-2"},We=c("h1",{class:"border-bottom-1 mb-2"},"Players",-1),Ye={class:"p-fluid mb-2"},qe=c("span",{class:"pi pi-plus"},null,-1),Ge=c("span",{class:"pi pi-minus"},null,-1),Je={class:"p-fluid"},Ke=U({__name:"FlyerForm",props:{players:{}},emits:["start","setName","reset"],setup(s,{emit:t}){const e=s,o=t,n=w(e.players.filter(y=>y).length),a=w("Round Robin"),u=w(["Round Robin"]),m=w(1),h=w(1),r=w(!1),f=M(()=>new G([]).estimateDuration(n.value,m.value,h.value)),x=new G([]).frameTimeEstimateMins;le(()=>{const y=document.getElementsByClassName("p-inputnumber-button");for(const d of y)d.addEventListener("mouseup",()=>{var _;(_=document.activeElement)==null||_.blur()})});const S=M(()=>e.players.slice(0,n.value)),l=()=>{r.value=!0},p=()=>{o("start",S.value,m.value,h.value),i()},i=()=>{r.value=!1};return(y,d)=>{const _=k("InputNumber"),N=k("SelectButton"),F=k("Button");return v(),g(B,null,[Ue,c("div",Pe,[b(_,{modelValue:m.value,"onUpdate:modelValue":d[0]||(d[0]=$=>m.value=$),showButtons:"",buttonLayout:"horizontal",min:1,max:5,prefix:"Races to ",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:I(()=>[Ee]),decrementbuttonicon:I(()=>[Le]),_:1},8,["modelValue"])]),c("div",je,[b(_,{modelValue:h.value,"onUpdate:modelValue":d[1]||(d[1]=$=>h.value=$),showButtons:"",buttonLayout:"horizontal",min:1,max:Math.floor(n.value/2),suffix:" table(s)",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:I(()=>[Ae]),decrementbuttonicon:I(()=>[Oe]),_:1},8,["modelValue","max"])]),c("div",ze,[b(N,{modelValue:a.value,"onUpdate:modelValue":d[2]||(d[2]=$=>a.value=$),options:u.value,allowEmpty:!1,"aria-labelledby":"basic"},null,8,["modelValue","options"])]),c("div",He,[c("p",null,[X("Estimated duration: "+C(f.value)+" min(s) ",1),c("em",null,"("+C(D(x))+" min(s) per frame)",1)])]),We,c("div",Ye,[b(_,{modelValue:n.value,"onUpdate:modelValue":d[3]||(d[3]=$=>n.value=$),showButtons:"",buttonLayout:"horizontal",min:2,max:10,suffix:" players",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:I(()=>[qe]),decrementbuttonicon:I(()=>[Ge]),_:1},8,["modelValue"])]),(v(!0),g(B,null,A(y.players,($,R)=>(v(),g("div",null,[b(Be,{class:"mb-2",placeholder:"Player "+(R+1),disabled:R>=n.value,name:$,onSetName:V=>o("setName",R,V)},null,8,["placeholder","disabled","name","onSetName"])]))),256)),c("div",Je,[b(F,{label:"Start",disabled:S.value.some($=>!$),onClick:l},null,8,["disabled"])]),b(q,{visible:r.value,header:"Start Flyer",message:"Are you ready to start the flyer?",onConfirm:p,onCancel:i},null,8,["visible"])],64)}}}),Qe=s=>(Z("data-v-4b498b21"),s=s(),ee(),s),Xe=Qe(()=>c("h1",{class:"border-bottom-1"},"Results",-1)),Ze={key:0},et=U({__name:"ResultsTable",setup(s){const t=H(),e=W(),o=l=>!l.finishTime||n(l)?null:l.scores.reduce((i,y)=>i.score>y.score?i:y).playerId,n=l=>{if(!l.finishTime)return!1;const p=l.scores.map(i=>i.score).reduce((i,y)=>Math.max(i,y));return l.scores.every(i=>i.score===p)},a=l=>!l.finishTime||n(l)?null:l.scores.reduce((i,y)=>i.score<y.score?i:y).playerId,u=(l,p)=>p.filter(i=>o(i)===l).length,m=(l,p)=>p.filter(i=>n(i)&&i.scores.some(y=>y.playerId===l)).length,h=(l,p)=>p.filter(i=>a(i)===l).length,r=(l,p)=>p.some(i=>i.scores.some(y=>y.playerId===l)&&!i.finishTime),f=M(()=>t.players.map(p=>({name:p.name,wins:u(p.id,e.results),draws:m(p.id,e.results),losses:h(p.id,e.results),incomplete:r(p.id,e.results)})).sort((p,i)=>p.wins!==i.wins?i.wins-p.wins:p.losses!==i.losses?i.losses-p.losses:0)),x=l=>[{"bg-primary":!l.incomplete&&l.rank===1,"bg-gray-400":l.incomplete}],S=f.value.filter(l=>l.incomplete).length;return(l,p)=>{const i=k("Column"),y=k("DataTable");return v(),g(B,null,[Xe,b(y,{value:f.value,rowClass:x},{default:I(()=>[b(i,{header:"#"},{body:I(d=>[X(C(d.index+1),1)]),_:1}),b(i,{field:"name",header:"Name"}),b(i,{field:"wins",header:"Won"}),b(i,{field:"draws",header:"Drew"}),b(i,{field:"losses",header:"Lost"})]),_:1},8,["value"]),D(S)>0?(v(),g("h4",Ze,[c("em",null,C(D(S))+" player(s) have incomplete results!",1)])):E("",!0)],64)}}}),tt=J(et,[["__scopeId","data-v-4b498b21"]]),st=s=>(Z("data-v-74cb8ecd"),s=s(),ee(),s),nt={key:0},ot={key:1},lt={class:"p-fluid mt-2"},at={key:2},rt={class:"p-fluid mt-2"},it=st(()=>c("footer",null,[c("a",{href:"https://www.flaticon.com/free-icons/ball-eight",title:"ball eight icons"},"Ball eight icons created by Boris farias - Flaticon")],-1)),ut=U({__name:"HomeView",setup(s){const t="Player 1;Player 2;Player 3;Player 4";let e=[];e=String(t).split(";"),e.length<10&&(e=[...e,...new Array(10-e.length).fill("")]);const o=w(0),n=w(e),a=H(),u=w(0),m=w(0);let h;const r=W(),f=w("Fixtures"),x=w(!1),S=w(!1),l=R=>{o.value=R,window.scroll(0,0)},p=(R,V)=>{n.value=n.value.map((P,se)=>se===R?V:P)},i=(R,V,P)=>{a.init(R),u.value=V,m.value=P,h=new G(a.players),r.setRounds(h.generateFixtures()),l(1)},y=()=>{x.value=!0},d=()=>{l(2),_()},_=()=>{x.value=!1},N=()=>{S.value=!0},F=()=>{l(0),a.clear(),u.value=0,r.clear()},$=()=>{S.value=!1};return(R,V)=>{const P=k("Button");return v(),g(B,null,[c("main",null,[o.value===0?(v(),g("div",nt,[b(Ke,{players:n.value,onSetName:p,onStart:i},null,8,["players"])])):o.value===1?(v(),g("div",ot,[f.value==="Fixtures"?(v(),L(Ve,{key:0,raceTo:u.value},null,8,["raceTo"])):E("",!0),c("div",lt,[b(P,{label:"Finish",onClick:y})]),b(q,{visible:x.value,header:"Finish Flyer",message:"Are you ready to finish the flyer?",onConfirm:d,onCancel:_},null,8,["visible"])])):o.value===2?(v(),g("div",at,[b(tt),c("div",rt,[b(P,{label:"Restart",onClick:N})]),b(q,{visible:S.value,header:"Restart",message:"Are you sure you want to restart? All data for the current flyer will be lost!",onConfirm:F,onCancel:$},null,8,["visible"])])):E("",!0)]),it],64)}}}),mt=J(ut,[["__scopeId","data-v-74cb8ecd"]]);export{mt as default};
