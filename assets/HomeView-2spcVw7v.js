var C=Object.defineProperty;var I=(d,e,t)=>e in d?C(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t;var y=(d,e,t)=>(I(d,typeof e!="symbol"?e+"":e,t),t);import{d as v,r as h,o as b,c as _,a as c,b as B,e as k,f as n,w as p,u as a,n as w,g as F,t as R,F as x,h as N,i as E,j as M,p as P,k as T}from"./index-DaRYtvcQ.js";import{u as V,F as g,v as U,a as $,_ as q,R as L,b as z}from"./_plugin-vue_export-helper-s9D9FR0L.js";const K={class:"player-name-input p-fluid"},j=v({__name:"PlayerNameInput",props:{name:{},placeholder:{},disabled:{type:Boolean}},emits:["setName"],setup(d,{emit:e}){const t=d,s=e;return(o,l)=>{const i=h("InputText");return b(),_("div",K,[c(i,{placeholder:t.placeholder,disabled:t.disabled,modelValue:t.name,"onUpdate:modelValue":l[0]||(l[0]=u=>s("setName",u||""))},null,8,["placeholder","disabled","modelValue"])])}}}),A=n("h1",{class:"border-bottom-1 mb-2"},"Format",-1),D={class:"p-fluid mb-2"},H=n("span",{class:"pi pi-plus"},null,-1),O=n("span",{class:"pi pi-minus"},null,-1),Q={class:"p-fluid mb-2"},G=n("span",{class:"pi pi-plus"},null,-1),J=n("span",{class:"pi pi-minus"},null,-1),W={class:"p-fluid mb-2"},X={class:"p-fluid flex justify-content-between mb-2"},Y={class:"p-fluid flex justify-content-between mb-2"},Z={class:"p-fluid border-top-1 mb-2"},ee={class:"font-bold"},te=n("h1",{class:"border-bottom-1 mb-2"},"Players",-1),oe={class:"p-fluid mb-2"},se=n("span",{class:"pi pi-plus"},null,-1),ne=n("span",{class:"pi pi-minus"},null,-1),le=v({__name:"FlyerForm",setup(d){const e=V(),t=B(()=>e.format===g.Knockout);return k(()=>{const s=document.getElementsByClassName("p-inputnumber-button");for(const o of s)o.addEventListener("mouseup",()=>{var l;(l=document.activeElement)==null||l.blur()})}),(s,o)=>{const l=h("InputNumber"),i=h("SelectButton"),u=h("Checkbox");return b(),_(x,null,[A,n("div",D,[c(l,{modelValue:a(e).raceTo,"onUpdate:modelValue":o[0]||(o[0]=r=>a(e).raceTo=r),showButtons:"",buttonLayout:"horizontal",min:1,max:5,prefix:"Races to ",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:p(()=>[H]),decrementbuttonicon:p(()=>[O]),_:1},8,["modelValue"])]),n("div",Q,[c(l,{modelValue:a(e).tableCount,"onUpdate:modelValue":o[1]||(o[1]=r=>a(e).tableCount=r),showButtons:"",buttonLayout:"horizontal",min:1,max:Math.floor(a(e).playerCount/2),suffix:" table(s)",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:p(()=>[G]),decrementbuttonicon:p(()=>[J]),_:1},8,["modelValue","max"])]),n("div",W,[c(i,{modelValue:a(e).format,"onUpdate:modelValue":o[2]||(o[2]=r=>a(e).format=r),options:a(e).formatOptions,allowEmpty:!1,"aria-labelledby":"basic"},null,8,["modelValue","options"])]),n("div",X,[n("label",{for:"requireCompletedRoundsCheckbox",class:w([t.value&&"text-color-secondary"])}," Require completed rounds ",2),c(u,{inputId:"requireCompletedRoundsCheckbox",modelValue:a(e).requireCompletedRounds,"onUpdate:modelValue":o[3]||(o[3]=r=>a(e).requireCompletedRounds=r),binary:!0,disabled:t.value},null,8,["modelValue","disabled"])]),n("div",Y,[n("label",{for:"allowEarlyFinishCheckbox",class:w([t.value&&"text-color-secondary"])}," Allow early finish ",2),c(u,{inputId:"allowEarlyFinishCheckbox",modelValue:a(e).allowEarlyFinish,"onUpdate:modelValue":o[4]||(o[4]=r=>a(e).allowEarlyFinish=r),binary:!0,disabled:t.value},null,8,["modelValue","disabled"])]),n("div",Z,[n("p",null,[F(" Estimated duration: "),n("span",ee,R(a(e).estimatedDuration)+" min(s)",1),F(),n("em",null,"("+R(a(e).durationPerFrame)+" min(s) per frame)",1)])]),te,n("div",oe,[c(l,{modelValue:a(e).playerCount,"onUpdate:modelValue":o[5]||(o[5]=r=>a(e).playerCount=r),showButtons:"",buttonLayout:"horizontal",min:2,max:10,suffix:" players",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:p(()=>[se]),decrementbuttonicon:p(()=>[ne]),_:1},8,["modelValue"])]),(b(!0),_(x,null,N(a(e).playerNames,(r,m)=>(b(),_("div",null,[c(j,{class:"mb-2",placeholder:"Player "+(m+1),disabled:m>=a(e).playerCount,name:r,onSetName:f=>a(e).setName(m,f)},null,8,["placeholder","disabled","name","onSetName"])]))),256))],64)}}});class ae{constructor(){y(this,"frameTimeEstimateMins",7);y(this,"generatedRounds")}estimateDuration(e,t,s){const o=e*(e-1)/2,l=2*t-1,i=(t+l)/2,u=o*i;return Math.ceil(this.frameTimeEstimateMins*u/s)}generateFixtures(e){if(this.generatedRounds!==void 0)throw"Fixtures have already been generated!";const t=this.shuffle([...e]),s=Math.ceil(Math.log2(e.length));let o=Math.pow(2,s),l=o/2;this.generatedRounds=[];let i=0;for(;i<s;){const u={index:i+1,name:this.getRoundName(o),fixtures:[]};console.log(u.name);for(let r=0;r<l;r++)if(i===0){const m=t.pop();this.addPlaceholderFixture(u,[m],2,[])}else{const f=this.generatedRounds[i-1].fixtures.slice(r*2,(r+1)*2).map(S=>S.id);this.addPlaceholderFixture(u,[],2,f)}for(;t.length>0;)this.fillFixture(u,t.pop());i===0&&this.fillByes(u),this.generatedRounds.push(u),o/=2,l/=2,i++}return this.generatedRounds}getRoundName(e){switch(e){case 2:return"Final";case 4:return"Semi-Finals";case 8:return"Quarter-Finals";default:return"Round of "+e}}addPlaceholderFixture(e,t,s,o){const l={id:U(),parentFixtureIds:o,scores:t.map(i=>({playerId:i.id,score:0})),startTime:null,finishTime:null};for(let i=l.scores.length;i<s;i++)l.scores.push({playerId:"",score:0,isBye:!1});e.fixtures.push(l)}fillFixture(e,t){for(let s of e.fixtures){const o=s.scores.find(l=>!l.playerId);if(o){o.playerId=t.id;return}}}fillByes(e){for(let t of e.fixtures){const s=t.scores.filter(o=>!o.playerId);for(const o of s)o.isBye=!0}}getCurrentRound(){if(this.generatedRounds===void 0)return 0;const e=this.generatedRounds.find(t=>t.fixtures.some(s=>!s.finishTime));return e?e.index:0}shuffle(e){let t=e.length,s=0;for(;t>0;){s=Math.floor(Math.random()*t),t--;const o=e[t];e[t]=e[s],e[s]=o}return e}}const ie=d=>(P("data-v-d0a1b02d"),d=d(),T(),d),re={class:"p-fluid"},ue=ie(()=>n("footer",null,[n("a",{href:"https://www.flaticon.com/free-icons/ball-eight",title:"ball eight icons"},"Ball eight icons created by Boris farias - Flaticon")],-1)),de=v({__name:"HomeView",setup(d){const e=M(),t=$(),s=V(),o=E(!1),l=()=>{switch(s.format){case g.Knockout:t.start(s.actualPlayers,new ae);break;case g.RoundRobin:t.start(s.actualPlayers,new L);break;default:throw`Invalid flyer format ${s.format}!`}u(),e.push({name:"play"})},i=()=>{o.value=!0},u=()=>{o.value=!1};return(r,m)=>{const f=h("Button");return b(),_(x,null,[n("main",null,[c(le),n("div",re,[c(f,{label:"Start",disabled:a(s).isInvalid,onClick:i},null,8,["disabled"])]),c(q,{visible:o.value,header:"Start Flyer",message:"Are you ready to start the flyer?",onConfirm:l,onHide:u},null,8,["visible"])]),ue],64)}}}),fe=z(de,[["__scopeId","data-v-d0a1b02d"]]);export{fe as default};
