var le=Object.defineProperty;var re=(n,e,t)=>e in n?le(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var E=(n,e,t)=>(re(n,typeof e!="symbol"?e+"":e,t),t);import{d as k,r as w,w as Y,c as N,a as $,b as I,o as f,e as c,t as T,f as _,g,n as z,h as J,u as b,i as F,F as M,j,k as P,l as ae,m as Z,p as ee,q as te}from"./index-DB-1Rnsd.js";const ie={class:"font-bold mb-2"},ue={class:"p-fluid"},q=k({__name:"ConfirmModal",props:{visible:{type:Boolean},header:{},message:{}},emits:["confirm","cancel"],setup(n,{emit:e}){const t=n,s=e,l=w(t.visible);return Y(t,()=>{l.value=t.visible}),(i,a)=>{const h=I("Button"),p=I("Dialog");return f(),N(p,{visible:l.value,"onUpdate:visible":a[2]||(a[2]=o=>l.value=o),modal:"",header:t.header,onHide:a[3]||(a[3]=o=>s("cancel"))},{default:$(()=>[c("div",ie,T(t.message),1),c("div",ue,[_(h,{class:"mb-2",type:"button",label:"Yes",onClick:a[0]||(a[0]=o=>s("confirm"))}),_(h,{type:"button",label:"No",severity:"secondary",onClick:a[1]||(a[1]=o=>s("cancel"))})])]),_:1},8,["visible","header"])}}}),ce={key:1},de=k({__name:"ScoreCell",props:{result:{}},emits:["showResultModal"],setup(n,{emit:e}){const t=n,s=e,l=i=>i.finishTime?"bg-primary":i.startTime?"in-progress":"bg-cyan-100";return(i,a)=>(f(),g("div",{class:z(["p-2 text-center cursor-pointer border-round-md",l(t.result)]),onClick:a[0]||(a[0]=()=>s("showResultModal"))},[t.result.startTime?(f(),g("span",{key:0,class:z([t.result.finishTime&&"font-bold"])},T(t.result.scores.map(h=>h.score).join("-")),3)):(f(),g("span",ce," ?-? "))],2))}}),K=(n,e)=>{const t=n.__vccOpts||n;for(const[s,l]of e)t[s]=l;return t},me=K(de,[["__scopeId","data-v-a0880355"]]);let A;const pe=new Uint8Array(16);function he(){if(!A&&(A=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!A))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return A(pe)}const C=[];for(let n=0;n<256;++n)C.push((n+256).toString(16).slice(1));function fe(n,e=0){return C[n[e+0]]+C[n[e+1]]+C[n[e+2]]+C[n[e+3]]+"-"+C[n[e+4]]+C[n[e+5]]+"-"+C[n[e+6]]+C[n[e+7]]+"-"+C[n[e+8]]+C[n[e+9]]+"-"+C[n[e+10]]+C[n[e+11]]+C[n[e+12]]+C[n[e+13]]+C[n[e+14]]+C[n[e+15]]}const ve=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),X={randomUUID:ve};function se(n,e,t){if(X.randomUUID&&!e&&!n)return X.randomUUID();n=n||{};const s=n.random||(n.rng||he)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){t=t||0;for(let l=0;l<16;++l)e[t+l]=s[l];return e}return fe(s)}const H=J("players",()=>{const n=w([]);return{players:n,init:l=>{n.value=l.map(i=>({id:se(),name:i}))},getName:l=>{var i;return((i=n.value.find(a=>a.id===l))==null?void 0:i.name)??l},clear:()=>n.value=[]}}),_e={class:"grid m-0"},be={class:"col-5"},ye={class:"col-2 p-0"},ge={class:"col-5 text-right"},xe=k({__name:"FixtureCard",props:{result:{}},emits:["showResultModal"],setup(n,{emit:e}){const t=n,s=e,l=H();return(i,a)=>(f(),g("div",_e,[c("div",be,T(b(l).getName(t.result.scores[0].playerId)),1),c("div",ye,[_(me,{result:t.result,onShowResultModal:a[0]||(a[0]=()=>s("showResultModal",t.result))},null,8,["result"])]),c("div",ge,T(b(l).getName(t.result.scores[1].playerId)),1)]))}}),W=J("rounds",()=>{const n=w([]),e=F(()=>n.value.flatMap(o=>o.fixtures)),t=F(()=>n.value.flatMap(o=>o.fixtures).filter(o=>!o.finishTime).length),s=F(()=>{const o=n.value.find(v=>v.fixtures.some(x=>!x.finishTime));return o?o.index:0}),l=o=>n.value.find(v=>v.fixtures.some(x=>x.id===o)),i=o=>n.value=o;return{rounds:n,results:e,remainingCount:t,currentRound:s,getRound:l,setRounds:i,startFixture:o=>{n.value=n.value.map(v=>v.startFixture(o))},updateResult:(o,v)=>{n.value=n.value.map(x=>x.updateResult(o,v))},clear:()=>i([])}});class G{constructor(e){E(this,"frameTimeEstimateMins",7);E(this,"generatedRounds");this.players=e}estimateDuration(e,t,s){const l=e*(e-1)/2,i=2*t-1,a=(t+i)/2,h=l*a;return Math.ceil(this.frameTimeEstimateMins*h/s)}generateFixtures(){if(this.generatedRounds!==void 0)throw"Fixtures have already been generated!";let e=0;const t=this.players.length%2!==0,s=t?this.players.length:this.players.length-1;this.generatedRounds=[];const l=this.shuffle(this.players.map((a,h)=>h));let i=0;for(;i<s&&e<10;){const a=new we(i+1,"Round "+(i+1));console.log(a.name);let h=!1,p=[...this.players];for(t&&(console.log("Omitting: "+p[l[i]].name),p.splice(l[i],1));p.length>1;){const o=this.getRandom(p),v=this.generatedRounds.flatMap(r=>r.getExistingOpponents(o)),x=p.filter(r=>!v.includes(r.id)&&o.id!==r.id);if(x.length<=0){console.log("Retrying round..."),h=!0;break}const S=this.getRandom(x);a.addFixture([o,S]),p=p.filter(r=>![o.id,S.id].includes(r.id))}if(h){e++;continue}this.generatedRounds.push(a),i++}return e>=10&&console.log("Failed to generate rounds after 10 attempts!"),this.generatedRounds}getCurrentRound(){if(this.generatedRounds===void 0)return 0;const e=this.generatedRounds.find(t=>t.fixtures.some(s=>!s.finishTime));return e?e.index:0}getRandom(e){return e[Math.floor(Math.random()*e.length)]}shuffle(e){let t=e.length,s=0;for(;t>0;){s=Math.floor(Math.random()*t),t--;const l=e[t];e[t]=e[s],e[s]=l}return e}}class we{constructor(e,t){E(this,"index");E(this,"name");E(this,"fixtures");this.index=e,this.name=t,this.fixtures=[]}addFixture(e){console.log(e.map(t=>t.name).join(" v ")),this.fixtures.push({id:se(),scores:e.map(t=>({playerId:t.id,score:0})),startTime:null,finishTime:null})}startFixture(e){const t=this.fixtures.findIndex(s=>s.id===e);return t>=0&&(this.fixtures[t].startTime=Date.now()),this}updateResult(e,t){const s=this.fixtures.findIndex(l=>l.id===e.id);return s>=0&&(t&&(e.finishTime=Date.now()),this.fixtures[s]=e),this}getExistingFixtures(e){return this.fixtures.filter(t=>t.scores.some(s=>s.playerId===e.id))}getExistingOpponents(e){const t=this.getExistingFixtures(e);return[...new Set(t.map(s=>s.scores.map(l=>l.playerId).filter(l=>l!==e.id)).flatMap(s=>s))]}}const Re="Player 1;Player 2;Player 3;Player 4";let D=[];D=String(Re).split(";");D.length<10&&(D=[...D,...new Array(10-D.length).fill("")]);const Q=J("flyer",()=>{const n=w(D.filter(m=>m).length),e=w(D),t=w(1),s=w(1),l=w("Round Robin"),i=w(["Round Robin"]),a=F(()=>e.value.slice(0,n.value)),h=F(()=>new G([]).estimateDuration(n.value,t.value,s.value)),p=F(()=>new G([]).frameTimeEstimateMins),o=F(()=>a.value.some(m=>!m)),v=m=>n.value=m,x=m=>e.value=m,S=(m,U)=>{e.value=e.value.map((y,R)=>R===m?U:y)},r=m=>t.value=m,d=m=>s.value=m;return{players:e,raceTo:t,tableCount:s,format:l,formatOptions:i,playerCount:n,estimatedDuration:h,durationPerFrame:p,actualPlayers:a,isInvalid:o,setPlayerCount:v,setPlayers:x,setName:S,setRaceTo:r,setTableCount:d,reset:()=>{r(1),d(1)}}}),Se={class:"flex flex-column md:flex-row md:align-items-center justify-content-between mb-2"},Ce={class:"font-bold"},Fe={class:"flex flex-column md:flex-row md:align-items-center justify-content-between mb-2"},Te={class:"font-bold"},$e={class:"md:ml-3"},Ie=c("span",{class:"pi pi-plus"},null,-1),Me=c("span",{class:"pi pi-minus"},null,-1),ke={class:"p-fluid"},Ve=k({__name:"RecordResultModal",props:{visible:{type:Boolean},round:{},result:{},waitForPreviousRounds:{type:Boolean}},emits:["cancel","start","confirm"],setup(n,{emit:e}){const t=Q(),s=n,l=e,i=H(),a=W(),h=w(s.visible),p=w(s.result.scores.map(y=>y.playerId)),o=w(s.result.scores.map(y=>y.score));Y([o],()=>{var y;(y=document.activeElement)==null||y.blur()}),Y(s,()=>{h.value=s.visible,p.value=s.result.scores.map(y=>y.playerId),o.value=s.result.scores.map(y=>y.score)});const v=(y,R)=>{o.value=o.value.map((L,V)=>V===y?R:L)},x=()=>l("start"),S=y=>{const R={id:s.result.id,scores:p.value.map((L,V)=>({playerId:L,score:o.value[V]})),startTime:s.result.startTime};l("confirm",R,y)},r=F(()=>s.waitForPreviousRounds&&s.round.index>a.currentRound?"Waiting for round to start":"Start"),d=F(()=>s.waitForPreviousRounds&&s.round.index>a.currentRound),u=F(()=>!!([...new Set(p.value)].length!==p.value.length||o.value.every(R=>R<t.raceTo))),m=F(()=>s.result.scores.map(y=>i.getName(y.playerId)).join(" v ")),U=F(()=>`${s.round.name} - ${m.value}`);return(y,R)=>{const L=I("InputNumber"),V=I("Button"),ne=I("Dialog");return f(),N(ne,{visible:h.value,"onUpdate:visible":R[3]||(R[3]=B=>h.value=B),modal:"",header:U.value,onHide:R[4]||(R[4]=B=>l("cancel"))},{default:$(()=>[s.result.finishTime?(f(!0),g(M,{key:0},j(p.value,(B,O)=>(f(),g("div",Se,[c("div",Ce,T(b(i).getName(B))+": "+T(o.value[O]),1)]))),256)):s.result.startTime?(f(!0),g(M,{key:1},j(p.value,(B,O)=>(f(),g("div",Fe,[c("div",Te,T(b(i).getName(B)),1),c("div",$e,[_(L,{showButtons:"",buttonLayout:"horizontal",modelValue:o.value[O],min:0,max:b(t).raceTo,"onUpdate:modelValue":oe=>v(O,oe)},{incrementbuttonicon:$(()=>[Ie]),decrementbuttonicon:$(()=>[Me]),_:2},1032,["modelValue","max","onUpdate:modelValue"])])]))),256)):P("",!0),c("div",ke,[s.result.startTime?P("",!0):(f(),N(V,{key:0,class:"mb-2",type:"button",label:r.value,disabled:d.value,onClick:x},null,8,["label","disabled"])),s.result.startTime&&!s.result.finishTime?(f(),N(V,{key:1,class:"mb-2",type:"button",label:"Update",severity:"info",onClick:R[0]||(R[0]=()=>S(!1))})):P("",!0),s.result.startTime&&!s.result.finishTime?(f(),N(V,{key:2,class:"mb-2",type:"button",label:"Finish",disabled:u.value,onClick:R[1]||(R[1]=()=>S(!0))},null,8,["disabled"])):P("",!0),_(V,{type:"button",label:"Close",severity:"secondary",onClick:R[2]||(R[2]=B=>l("cancel"))})])]),_:1},8,["visible","header"])}}}),Pe={class:"flex flex-column md:flex-row justify-content-between md:align-items-end border-bottom-1 pb-1"},Be=c("h1",null,"Fixtures",-1),Ne={class:"text-center"},De=k({__name:"FixtureList",setup(n){const e=W(),t=F(()=>{var o;return e.getRound(((o=s.value)==null?void 0:o.id)||"")}),s=w(),l=w(!1),i=o=>{s.value=o,l.value=!0},a=()=>{s.value&&(e.startFixture(s.value.id),p())},h=(o,v)=>{e.updateResult(o,v),p()},p=()=>{l.value=!1};return(o,v)=>(f(),g(M,null,[c("div",Pe,[Be,c("h4",null,"Results remaining: "+T(b(e).remainingCount),1)]),(f(!0),g(M,null,j(b(e).rounds,(x,S)=>(f(),g("div",{class:z([S>0&&"border border-top-1"])},[c("h3",Ne,T(x.name),1),(f(!0),g(M,null,j(x.fixtures,(r,d)=>(f(),g("div",{class:z(["mt-1 pt-1 mb-1",[d>0&&"border-gray-200 border-top-1"]])},[_(xe,{result:r,onShowResultModal:()=>i(r)},null,8,["result","onShowResultModal"])],2))),256))],2))),256)),t.value&&s.value?(f(),N(Ve,{key:0,visible:l.value,round:t.value,result:s.value,waitForPreviousRounds:!1,onStart:a,onConfirm:h,onCancel:p},null,8,["visible","round","result"])):P("",!0)],64))}}),Ue={class:"player-name-input p-fluid"},Ee=k({__name:"PlayerNameInput",props:{name:{},placeholder:{},disabled:{type:Boolean}},emits:["setName"],setup(n,{emit:e}){const t=n,s=e;return(l,i)=>{const a=I("InputText");return f(),g("div",Ue,[_(a,{placeholder:t.placeholder,disabled:t.disabled,modelValue:t.name,"onUpdate:modelValue":i[0]||(i[0]=h=>s("setName",h||""))},null,8,["placeholder","disabled","modelValue"])])}}}),Le=c("h1",{class:"border-bottom-1 mb-2"},"Format",-1),je={class:"p-fluid mb-2"},Oe=c("span",{class:"pi pi-plus"},null,-1),Ae=c("span",{class:"pi pi-minus"},null,-1),ze={class:"p-fluid mb-2"},He=c("span",{class:"pi pi-plus"},null,-1),We=c("span",{class:"pi pi-minus"},null,-1),Ye={class:"p-fluid mb-2"},qe={class:"p-fluid mb-2"},Ge=c("h1",{class:"border-bottom-1 mb-2"},"Players",-1),Je={class:"p-fluid mb-2"},Ke=c("span",{class:"pi pi-plus"},null,-1),Qe=c("span",{class:"pi pi-minus"},null,-1),Xe={class:"p-fluid"},Ze=k({__name:"FlyerForm",emits:["start","reset"],setup(n,{emit:e}){const t=Q(),s=e,l=w(!1);ae(()=>{const p=document.getElementsByClassName("p-inputnumber-button");for(const o of p)o.addEventListener("mouseup",()=>{var v;(v=document.activeElement)==null||v.blur()})});const i=()=>{l.value=!0},a=()=>{s("start"),h()},h=()=>{l.value=!1};return(p,o)=>{const v=I("InputNumber"),x=I("SelectButton"),S=I("Button");return f(),g(M,null,[Le,c("div",je,[_(v,{modelValue:b(t).raceTo,"onUpdate:modelValue":o[0]||(o[0]=r=>b(t).raceTo=r),showButtons:"",buttonLayout:"horizontal",min:1,max:5,prefix:"Races to ",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:$(()=>[Oe]),decrementbuttonicon:$(()=>[Ae]),_:1},8,["modelValue"])]),c("div",ze,[_(v,{modelValue:b(t).tableCount,"onUpdate:modelValue":o[1]||(o[1]=r=>b(t).tableCount=r),showButtons:"",buttonLayout:"horizontal",min:1,max:Math.floor(b(t).playerCount/2),suffix:" table(s)",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:$(()=>[He]),decrementbuttonicon:$(()=>[We]),_:1},8,["modelValue","max"])]),c("div",Ye,[_(x,{modelValue:b(t).format,"onUpdate:modelValue":o[2]||(o[2]=r=>b(t).format=r),options:b(t).formatOptions,allowEmpty:!1,"aria-labelledby":"basic"},null,8,["modelValue","options"])]),c("div",qe,[c("p",null,[Z("Estimated duration: "+T(b(t).estimatedDuration)+" min(s) ",1),c("em",null,"("+T(b(t).durationPerFrame)+" min(s) per frame)",1)])]),Ge,c("div",Je,[_(v,{modelValue:b(t).playerCount,"onUpdate:modelValue":o[3]||(o[3]=r=>b(t).playerCount=r),showButtons:"",buttonLayout:"horizontal",min:2,max:10,suffix:" players",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:$(()=>[Ke]),decrementbuttonicon:$(()=>[Qe]),_:1},8,["modelValue"])]),(f(!0),g(M,null,j(b(t).players,(r,d)=>(f(),g("div",null,[_(Ee,{class:"mb-2",placeholder:"Player "+(d+1),disabled:d>=b(t).playerCount,name:r,onSetName:u=>b(t).setName(d,u)},null,8,["placeholder","disabled","name","onSetName"])]))),256)),c("div",Xe,[_(S,{label:"Start",disabled:b(t).isInvalid,onClick:i},null,8,["disabled"])]),_(q,{visible:l.value,header:"Start Flyer",message:"Are you ready to start the flyer?",onConfirm:a,onCancel:h},null,8,["visible"])],64)}}}),et=n=>(ee("data-v-4b498b21"),n=n(),te(),n),tt=et(()=>c("h1",{class:"border-bottom-1"},"Results",-1)),st={key:0},nt=k({__name:"ResultsTable",setup(n){const e=H(),t=W(),s=r=>!r.finishTime||l(r)?null:r.scores.reduce((u,m)=>u.score>m.score?u:m).playerId,l=r=>{if(!r.finishTime)return!1;const d=r.scores.map(u=>u.score).reduce((u,m)=>Math.max(u,m));return r.scores.every(u=>u.score===d)},i=r=>!r.finishTime||l(r)?null:r.scores.reduce((u,m)=>u.score<m.score?u:m).playerId,a=(r,d)=>d.filter(u=>s(u)===r).length,h=(r,d)=>d.filter(u=>l(u)&&u.scores.some(m=>m.playerId===r)).length,p=(r,d)=>d.filter(u=>i(u)===r).length,o=(r,d)=>d.some(u=>u.scores.some(m=>m.playerId===r)&&!u.finishTime),v=F(()=>e.players.map(d=>({name:d.name,wins:a(d.id,t.results),draws:h(d.id,t.results),losses:p(d.id,t.results),incomplete:o(d.id,t.results)})).sort((d,u)=>d.wins!==u.wins?u.wins-d.wins:d.losses!==u.losses?u.losses-d.losses:0)),x=r=>[{"bg-primary":!r.incomplete&&r.rank===1,"bg-gray-400":r.incomplete}],S=v.value.filter(r=>r.incomplete).length;return(r,d)=>{const u=I("Column"),m=I("DataTable");return f(),g(M,null,[tt,_(m,{value:v.value,rowClass:x},{default:$(()=>[_(u,{header:"#"},{body:$(U=>[Z(T(U.index+1),1)]),_:1}),_(u,{field:"name",header:"Name"}),_(u,{field:"wins",header:"Won"}),_(u,{field:"draws",header:"Drew"}),_(u,{field:"losses",header:"Lost"})]),_:1},8,["value"]),b(S)>0?(f(),g("h4",st,[c("em",null,T(b(S))+" player(s) have incomplete results!",1)])):P("",!0)],64)}}}),ot=K(nt,[["__scopeId","data-v-4b498b21"]]),lt=n=>(ee("data-v-d9fe2c0f"),n=n(),te(),n),rt={key:0},at={key:1},it={class:"p-fluid mt-2"},ut={key:2},ct={class:"p-fluid mt-2"},dt=lt(()=>c("footer",null,[c("a",{href:"https://www.flaticon.com/free-icons/ball-eight",title:"ball eight icons"},"Ball eight icons created by Boris farias - Flaticon")],-1)),mt=k({__name:"HomeView",setup(n){const e=w(0),t=Q(),s=H(),l=W(),i=w("Fixtures"),a=w(!1),h=w(!1),p=m=>{e.value=m,window.scroll(0,0)},o=()=>{s.init(t.actualPlayers);const m=new G(s.players);l.setRounds(m.generateFixtures()),p(1)},v=()=>{a.value=!0},x=()=>{p(2),S()},S=()=>{a.value=!1},r=()=>{h.value=!0},d=()=>{p(0),s.clear(),l.clear()},u=()=>{h.value=!1};return(m,U)=>{const y=I("Button");return f(),g(M,null,[c("main",null,[e.value===0?(f(),g("div",rt,[_(Ze,{onStart:o})])):e.value===1?(f(),g("div",at,[i.value==="Fixtures"?(f(),N(De,{key:0})):P("",!0),c("div",it,[_(y,{label:"Finish",onClick:v})]),_(q,{visible:a.value,header:"Finish Flyer",message:"Are you ready to finish the flyer?",onConfirm:x,onCancel:S},null,8,["visible"])])):e.value===2?(f(),g("div",ut,[_(ot),c("div",ct,[_(y,{label:"Restart",onClick:r})]),_(q,{visible:h.value,header:"Restart",message:"Are you sure you want to restart? All data for the current flyer will be lost!",onConfirm:d,onCancel:u},null,8,["visible"])])):P("",!0)]),dt],64)}}}),ft=K(mt,[["__scopeId","data-v-d9fe2c0f"]]);export{ft as default};
