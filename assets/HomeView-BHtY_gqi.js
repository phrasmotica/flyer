var Q=Object.defineProperty;var X=(o,s,e)=>s in o?Q(o,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[s]=e;var P=(o,s,e)=>(X(o,typeof s!="symbol"?s+"":s,e),e);import{d as B,o as v,c as h,a as m,t as k,n as E,r as x,w as L,b as S,e as M,f as C,g as V,h as U,i as g,F,j as D,k as Y,l as A,u as j,p as H,m as W}from"./index-CCz_qvws.js";let N;const Z=new Uint8Array(16);function q(){if(!N&&(N=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!N))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return N(Z)}const I=[];for(let o=0;o<256;++o)I.push((o+256).toString(16).slice(1));function ee(o,s=0){return I[o[s+0]]+I[o[s+1]]+I[o[s+2]]+I[o[s+3]]+"-"+I[o[s+4]]+I[o[s+5]]+"-"+I[o[s+6]]+I[o[s+7]]+"-"+I[o[s+8]]+I[o[s+9]]+"-"+I[o[s+10]]+I[o[s+11]]+I[o[s+12]]+I[o[s+13]]+I[o[s+14]]+I[o[s+15]]}const te=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),z={randomUUID:te};function G(o,s,e){if(z.randomUUID&&!s&&!o)return z.randomUUID();o=o||{};const r=o.random||(o.rng||q)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,s){e=e||0;for(let l=0;l<16;++l)s[e+l]=r[l];return s}return ee(r)}const se={class:"grid m-0"},ne={class:"col-5"},oe={key:0},le={key:1},ae={class:"col-5 text-right"},re=B({__name:"FixtureCard",props:{players:{},result:{}},emits:["showResultModal"],setup(o,{emit:s}){const e=o,r=s,l=c=>c!=null&&c.startTime?"bg-cyan-400":"bg-cyan-100",i=c=>{var y;return((y=e.players.find(_=>_.id===c))==null?void 0:y.name)??c};return(c,y)=>{var _;return v(),h("div",se,[m("div",ne,k(i(e.result.scores[0].playerId)),1),m("div",{class:E(["col-2 text-center cursor-pointer",l(e.result)]),onClick:y[0]||(y[0]=()=>r("showResultModal",e.result))},[(_=e.result)!=null&&_.startTime?(v(),h("span",oe,k(e.result.scores.map(b=>b.score).join("-")),1)):(v(),h("span",le," ?-? "))],2),m("div",ae,k(i(e.result.scores[1].playerId)),1)])}}}),ue=B({__name:"PlayerDropdown",props:{players:{},selectedPlayerId:{}},emits:["select"],setup(o,{emit:s}){const e=o,r=s,l=x(e.selectedPlayerId);return L(l,()=>{r("select",l.value)}),(i,c)=>{const y=S("Dropdown");return v(),M(y,{modelValue:l.value,"onUpdate:modelValue":c[0]||(c[0]=_=>l.value=_),options:e.players,optionLabel:"name",optionValue:"id"},null,8,["modelValue","options"])}}}),ie={class:"flex flex-column md:flex-row md:align-items-center justify-content-between mb-2"},ce={class:"font-bold p-fluid mb-2 md:mb-0"},de={class:"md:ml-3"},me=m("span",{class:"pi pi-plus"},null,-1),pe=m("span",{class:"pi pi-minus"},null,-1),_e={class:"flex justify-content-end gap-2"},J=B({__name:"RecordResultModal",props:{visible:{type:Boolean},players:{},result:{},raceTo:{}},emits:["cancel","confirm"],setup(o,{emit:s}){const e=o,r=s,l=x(e.visible),i=x(e.result.scores.map(p=>p.playerId)),c=x(e.result.scores.map(p=>p.score));L([c],()=>{var p;(p=document.activeElement)==null||p.blur()}),L(e,()=>{l.value=e.visible,i.value=e.result.scores.map(p=>p.playerId),c.value=e.result.scores.map(p=>p.score)});const y=C(()=>e.players),_=(p,t)=>{i.value=i.value.map((a,n)=>n===p?t:a)},b=(p,t)=>{c.value=c.value.map((a,n)=>n===p?t:a)},f=()=>{const p={id:e.result.id,scores:i.value.map((t,a)=>({playerId:t,score:c.value[a]})),startTime:e.result.startTime||Date.now()};r("confirm",p)},T=C(()=>!!([...new Set(i.value)].length!==i.value.length||c.value.every(t=>t<e.raceTo))),$=C(()=>`Record Result (${e.result.startTime?"in progress":"not started"})`);return(p,t)=>{const a=S("InputNumber"),n=S("Button"),u=S("Dialog");return v(),M(u,{visible:l.value,"onUpdate:visible":t[1]||(t[1]=d=>l.value=d),modal:"",header:$.value},{default:V(()=>[(v(!0),h(F,null,U(i.value,(d,w)=>(v(),h("div",ie,[m("div",ce,[g(ue,{players:y.value,selectedPlayerId:d,onSelect:R=>_(w,R)},null,8,["players","selectedPlayerId","onSelect"])]),m("div",de,[g(a,{showButtons:"",buttonLayout:"horizontal",modelValue:c.value[w],min:0,max:e.raceTo,"onUpdate:modelValue":R=>b(w,R)},{incrementbuttonicon:V(()=>[me]),decrementbuttonicon:V(()=>[pe]),_:2},1032,["modelValue","max","onUpdate:modelValue"])])]))),256)),m("div",_e,[g(n,{type:"button",label:"Cancel",severity:"secondary",onClick:t[0]||(t[0]=d=>r("cancel"))}),g(n,{type:"button",label:"Save",disabled:T.value,onClick:f},null,8,["disabled"])])]),_:1},8,["visible","header"])}}}),ve={class:"flex flex-column md:flex-row justify-content-between md:align-items-end border-bottom-1 pb-1"},ye=m("h1",null,"Fixtures",-1),he={class:"text-center"},be=B({__name:"FixtureList",props:{players:{},raceTo:{},rounds:{}},emits:["updateResult"],setup(o,{emit:s}){const e=o,r=s,l=x(),i=x(!1),c=C(()=>e.rounds.flatMap(f=>f.fixtures).filter(f=>!f.startTime).length),y=f=>{l.value=f,i.value=!0},_=f=>{r("updateResult",f),b()},b=()=>{i.value=!1};return(f,T)=>(v(),h(F,null,[m("div",ve,[ye,m("h4",null,"Results remaining: "+k(c.value),1)]),(v(!0),h(F,null,U(e.rounds,($,p)=>(v(),h("div",{class:E([p>0&&"border border-top-1"])},[m("h3",he,k($.name),1),(v(!0),h(F,null,U($.fixtures,(t,a)=>(v(),h("div",{class:E(["mt-1 pt-1 mb-1",[a>0&&"border-gray-200 border-top-1"]])},[g(re,{players:e.players,result:t,onShowResultModal:()=>y(t)},null,8,["players","result","onShowResultModal"])],2))),256))],2))),256)),l.value?(v(),M(J,{key:0,visible:i.value,players:e.players,result:l.value,raceTo:e.raceTo,onConfirm:_,onCancel:b},null,8,["visible","players","result","raceTo"])):D("",!0)],64))}}),fe={class:"player-name-input p-fluid"},ge=B({__name:"PlayerNameInput",props:{name:{},placeholder:{},disabled:{type:Boolean}},emits:["setName"],setup(o,{emit:s}){const e=o,r=s;return(l,i)=>{const c=S("InputText");return v(),h("div",fe,[g(c,{placeholder:e.placeholder,disabled:e.disabled,modelValue:e.name,"onUpdate:modelValue":i[0]||(i[0]=y=>r("setName",y||""))},null,8,["placeholder","disabled","modelValue"])])}}});class O{constructor(s){P(this,"frameTimeEstimateMins",7);this.players=s}estimateDuration(s,e,r){const l=s*(s-1)/2,i=2*e-1,c=(e+i)/2,y=l*c;return Math.ceil(this.frameTimeEstimateMins*y/r)}generateFixtures(){let s=0;const e=this.players.length%2!==0,r=e?this.players.length:this.players.length-1,l=[],i=this.shuffle(this.players.map((y,_)=>_));let c=0;for(;c<r&&s<10;){const y=new xe("Round "+(c+1));console.log(y.name);let _=!1,b=[...this.players];for(e&&(console.log("Omitting: "+b[i[c]].name),b.splice(i[c],1));b.length>1;){const f=this.getRandom(b),T=l.flatMap(t=>t.getExistingOpponents(f)),$=b.filter(t=>!T.includes(t.id)&&f.id!==t.id);if($.length<=0){console.log("Retrying round..."),_=!0;break}const p=this.getRandom($);y.addFixture([f,p]),b=b.filter(t=>![f.id,p.id].includes(t.id))}if(_){s++;continue}l.push(y),c++}return s>=10&&console.log("Failed to generate rounds after 10 attempts!"),l}getRandom(s){return s[Math.floor(Math.random()*s.length)]}shuffle(s){let e=s.length,r=0;for(;e>0;){r=Math.floor(Math.random()*e),e--;const l=s[e];s[e]=s[r],s[r]=l}return s}}class xe{constructor(s){P(this,"name");P(this,"fixtures");this.name=s,this.fixtures=[]}addFixture(s){console.log(s.map(e=>e.name).join(" v ")),this.fixtures.push({id:G(),scores:s.map(e=>({playerId:e.id,score:0})),startTime:null})}updateResult(s){const e=this.fixtures.findIndex(r=>r.id===s.id);return e>=0&&(this.fixtures[e]=s),this}getExistingFixtures(s){return this.fixtures.filter(e=>e.scores.some(r=>r.playerId===s.id))}getExistingOpponents(s){const e=this.getExistingFixtures(s);return[...new Set(e.map(r=>r.scores.map(l=>l.playerId).filter(l=>l!==s.id)).flatMap(r=>r))]}}const we=m("h1",{class:"border-bottom-1 mb-2"},"Format",-1),Re={class:"p-fluid mb-2"},Ie=m("span",{class:"pi pi-plus"},null,-1),Te=m("span",{class:"pi pi-minus"},null,-1),$e={class:"p-fluid mb-2"},Se=m("span",{class:"pi pi-plus"},null,-1),Ve=m("span",{class:"pi pi-minus"},null,-1),ke={class:"p-fluid mb-2"},Ce={class:"p-fluid mb-2"},Fe=m("h1",{class:"border-bottom-1 mb-2"},"Players",-1),Be={class:"p-fluid mb-2"},Me=m("span",{class:"pi pi-plus"},null,-1),De=m("span",{class:"pi pi-minus"},null,-1),Ue={class:"p-fluid"},Pe=B({__name:"FlyerForm",props:{players:{}},emits:["start","setName","reset"],setup(o,{emit:s}){const e=o,r=s,l=x(4),i=x("Round Robin"),c=x(["Round Robin"]),y=x(1),_=x(1),b=C(()=>new O([]).estimateDuration(l.value,y.value,_.value)),f=new O([]).frameTimeEstimateMins;Y(()=>{const p=document.getElementsByClassName("p-inputnumber-button");for(const t of p)t.addEventListener("mouseup",()=>{var a;(a=document.activeElement)==null||a.blur()})});const T=C(()=>e.players.slice(0,l.value)),$=()=>r("start",T.value,y.value,_.value);return(p,t)=>{const a=S("InputNumber"),n=S("SelectButton"),u=S("Button");return v(),h(F,null,[we,m("div",Re,[g(a,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=d=>y.value=d),showButtons:"",buttonLayout:"horizontal",min:1,max:5,prefix:"Races to ",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:V(()=>[Ie]),decrementbuttonicon:V(()=>[Te]),_:1},8,["modelValue"])]),m("div",$e,[g(a,{modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=d=>_.value=d),showButtons:"",buttonLayout:"horizontal",min:1,max:Math.floor(l.value/2),suffix:" table(s)",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:V(()=>[Se]),decrementbuttonicon:V(()=>[Ve]),_:1},8,["modelValue","max"])]),m("div",ke,[g(n,{modelValue:i.value,"onUpdate:modelValue":t[2]||(t[2]=d=>i.value=d),options:c.value,allowEmpty:!1,"aria-labelledby":"basic"},null,8,["modelValue","options"])]),m("div",Ce,[m("p",null,[A("Estimated duration: "+k(b.value)+" min(s) ",1),m("em",null,"("+k(j(f))+" min(s) per frame)",1)])]),Fe,m("div",Be,[g(a,{modelValue:l.value,"onUpdate:modelValue":t[3]||(t[3]=d=>l.value=d),showButtons:"",buttonLayout:"horizontal",min:2,max:10,suffix:" players",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:V(()=>[Me]),decrementbuttonicon:V(()=>[De]),_:1},8,["modelValue"])]),(v(!0),h(F,null,U(p.players,(d,w)=>(v(),h("div",null,[g(ge,{class:"mb-2",placeholder:"Player "+(w+1),disabled:w>=l.value,name:d,onSetName:R=>r("setName",w,R)},null,8,["placeholder","disabled","name","onSetName"])]))),256)),m("div",Ue,[g(u,{label:"Start",disabled:T.value.some(d=>!d),onClick:$},null,8,["disabled"])])],64)}}}),Ne=o=>(H("data-v-d8b3f8dd"),o=o(),W(),o),Ee=Ne(()=>m("h1",{class:"border-bottom-1"},"Results",-1)),Le={key:0},je=B({__name:"ResultsTable",props:{players:{},results:{}},setup(o){const s=o,e=t=>r(t)?null:t.scores.reduce((n,u)=>n.score>u.score?n:u).playerId,r=t=>{const a=t.scores.map(n=>n.score).reduce((n,u)=>Math.max(n,u));return t.scores.every(n=>n.score===a)},l=t=>r(t)?null:t.scores.reduce((n,u)=>n.score<u.score?n:u).playerId,i=(t,a)=>a.filter(n=>e(n)===t).length,c=(t,a)=>a.filter(n=>r(n)&&n.scores.some(u=>u.playerId===t)).length,y=(t,a)=>a.filter(n=>l(n)===t).length,_=(t,a)=>a.filter(n=>n.scores.some(u=>u.playerId===t)).length<s.players.length-1,b=(t,a,n)=>{const u=i(t,n),d=i(a,n);if(u!==d)return d-u;const w=y(t,n),R=y(a,n);return w!==R?R-w:0},f=C(()=>s.players.sort((t,a)=>b(t.id,a.id,s.results))),T=C(()=>f.value.map((t,a)=>({rank:a+1,name:t.name,wins:i(t.id,s.results),draws:c(t.id,s.results),losses:y(t.id,s.results),incomplete:_(t.id,s.results)}))),$=t=>[{"bg-primary":!t.incomplete&&t.rank===1,"bg-gray-400":t.incomplete}],p=T.value.filter(t=>t.incomplete).length;return(t,a)=>{const n=S("Column"),u=S("DataTable");return v(),h(F,null,[Ee,g(u,{value:T.value,rowClass:$},{default:V(()=>[g(n,{field:"rank",header:"#"}),g(n,{field:"name",header:"Name"}),g(n,{field:"wins",header:"Won"}),g(n,{field:"draws",header:"Drew"}),g(n,{field:"losses",header:"Lost"})]),_:1},8,["value"]),j(p)>0?(v(),h("h4",Le,[m("em",null,k(j(p))+" player(s) have incomplete results!",1)])):D("",!0)],64)}}}),K=(o,s)=>{const e=o.__vccOpts||o;for(const[r,l]of s)e[r]=l;return e},Oe=K(je,[["__scopeId","data-v-d8b3f8dd"]]),ze={class:"flex flex-column md:flex-row justify-content-between md:align-items-end border-bottom-1 pb-1"},Ae=m("h1",null,"Round-Robin",-1),He={key:0,class:"flex justify-content-center"},We=["onClick"],Ge={key:0},Je={key:1},Ke={key:2,class:"flex justify-content-center"},Qe=B({__name:"RoundRobinTable",props:{players:{},raceTo:{},results:{}},emits:["updateResult"],setup(o,{emit:s}){const e=o,r=s,l=x(),i=x(!1),c=C(()=>e.results.filter(t=>!t.startTime).length),y=(t,a)=>e.results.some(n=>n.scores.some(u=>u.playerId===t)&&n.scores.some(u=>u.playerId===a)),_=(t,a)=>e.results.find(n=>n.scores.some(u=>u.playerId===t)&&n.scores.some(u=>u.playerId===a)),b=(t,a)=>{const n=_(t,a);return n?n.scores.find(u=>u.playerId===t).score:null},f=(t,a)=>{const n=b(t,a),u=b(a,t);if(n===null||u===null)return"";const d=_(t,a);return d!=null&&d.startTime?n>u?"bg-primary":n<u?"bg-red-500":"bg-yellow-200":"bg-cyan-100"},T=(t,a)=>{l.value=_(t.id,a.id),i.value=!0},$=t=>{r("updateResult",t),p()},p=()=>{i.value=!1};return(t,a)=>{const n=S("Column"),u=S("DataTable");return v(),h(F,null,[m("div",ze,[Ae,m("h4",null,"Results remaining: "+k(c.value),1)]),g(u,{value:e.players},{default:V(()=>[g(n,null,{body:V(d=>[A(k(d.data.name),1)]),_:1}),(v(!0),h(F,null,U(e.players,(d,w)=>(v(),M(n,{header:d.name},{body:V(R=>[R.index===w?(v(),h("div",He," - ")):y(R.data.id,d.id)?(v(),h("div",{key:1,class:E(["flex justify-content-center cursor-pointer",f(R.data.id,d.id)]),onClick:()=>T(R.data,d)},[_(R.data.id,d.id).startTime?(v(),h("span",Ge,k(b(R.data.id,d.id))+"-"+k(b(d.id,R.data.id)),1)):(v(),h("span",Je," ?-? "))],10,We)):(v(),h("div",Ke," ? "))]),_:2},1032,["header"]))),256))]),_:1},8,["value"]),l.value?(v(),M(J,{key:0,visible:i.value,players:e.players,result:l.value,raceTo:e.raceTo,onConfirm:$,onCancel:p},null,8,["visible","players","result","raceTo"])):D("",!0)],64)}}}),Xe=o=>(H("data-v-4c496a0a"),o=o(),W(),o),Ye={key:0},Ze={key:1},qe={class:"p-fluid"},et={class:"p-fluid mt-2"},tt={key:2},st={class:"p-fluid mt-2"},nt=Xe(()=>m("footer",null,[m("a",{href:"https://www.flaticon.com/free-icons/ball-eight",title:"ball eight icons"},"Ball eight icons created by Boris farias - Flaticon")],-1)),ot=B({__name:"HomeView",setup(o){const s="Player 1;Player 2;Player 3;Player 4";let e=[];e=String(s).split(";"),e.length<10&&(e=[...e,...new Array(10-e.length).fill("")]);const r=x(0),l=x(e),i=x([]),c=x(0),y=x(0),_=x([]),b=C(()=>_.value.flatMap(n=>n.fixtures)),f=x("List"),T=n=>r.value=n,$=(n,u)=>{l.value=l.value.map((d,w)=>w===n?u:d)},p=(n,u,d)=>{i.value=n.map(w=>({id:G(),name:w})),c.value=u,y.value=d,_.value=new O(i.value).generateFixtures(),T(1)},t=n=>{_.value=_.value.map(u=>u.updateResult(n))},a=()=>{T(0),i.value=[],c.value=0,_.value=[]};return(n,u)=>{const d=S("SelectButton"),w=S("Button");return v(),h(F,null,[m("main",null,[r.value===0?(v(),h("div",Ye,[g(Pe,{players:l.value,onSetName:$,onStart:p},null,8,["players"])])):r.value===1?(v(),h("div",Ze,[m("div",qe,[g(d,{modelValue:f.value,"onUpdate:modelValue":u[0]||(u[0]=R=>f.value=R),options:["List","Table"],allowEmpty:!1,"aria-labelledby":"basic"},null,8,["modelValue","options"])]),f.value==="List"?(v(),M(be,{key:0,players:i.value,raceTo:c.value,rounds:_.value,onUpdateResult:t},null,8,["players","raceTo","rounds"])):D("",!0),f.value==="Table"?(v(),M(Qe,{key:1,players:i.value,raceTo:c.value,results:b.value,onUpdateResult:t},null,8,["players","raceTo","results"])):D("",!0),m("div",et,[g(w,{label:"Finish",onClick:u[1]||(u[1]=()=>T(2))})])])):r.value===2?(v(),h("div",tt,[g(Oe,{players:i.value,results:b.value},null,8,["players","results"]),m("div",st,[g(w,{label:"Restart",onClick:a})])])):D("",!0)]),nt],64)}}}),rt=K(ot,[["__scopeId","data-v-4c496a0a"]]);export{rt as default};
