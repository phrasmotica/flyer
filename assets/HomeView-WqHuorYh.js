var ie=Object.defineProperty;var re=(s,t,e)=>t in s?ie(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var N=(s,t,e)=>(re(s,typeof t!="symbol"?t+"":t,e),e);import{d as M,r as g,w as Y,c as E,a as k,b as $,o as b,e as a,t as I,f as v,g as _,n as O,h as Q,u as p,i as C,F as V,j as H,k as D,l as ae,m as G,p as te,q as se}from"./index-CTciqQNf.js";const ue={class:"font-bold mb-2"},de={class:"p-fluid"},J=M({__name:"ConfirmModal",props:{visible:{type:Boolean},header:{},message:{}},emits:["confirm","hide"],setup(s,{emit:t}){const e=s,o=t,l=g(e.visible);return Y(e,()=>{l.value=e.visible}),(c,r)=>{const h=$("Button"),m=$("Dialog");return b(),E(m,{visible:l.value,"onUpdate:visible":r[2]||(r[2]=u=>l.value=u),modal:"",header:e.header,onHide:r[3]||(r[3]=u=>o("hide"))},{default:k(()=>[a("div",ue,I(e.message),1),a("div",de,[v(h,{class:"mb-2",type:"button",label:"Yes",onClick:r[0]||(r[0]=u=>o("confirm"))}),v(h,{type:"button",label:"No",severity:"secondary",onClick:r[1]||(r[1]=u=>o("hide"))})])]),_:1},8,["visible","header"])}}}),ce={key:1},me=M({__name:"ScoreCell",props:{result:{}},emits:["showResultModal"],setup(s,{emit:t}){const e=s,o=t,l=c=>c.finishTime?"bg-primary":c.startTime?"in-progress":"bg-cyan-100";return(c,r)=>(b(),_("div",{class:O(["p-2 text-center cursor-pointer border-round-md",l(e.result)]),onClick:r[0]||(r[0]=()=>o("showResultModal"))},[e.result.startTime?(b(),_("span",{key:0,class:O([e.result.finishTime&&"font-bold"])},I(e.result.scores.map(h=>h.score).join("-")),3)):(b(),_("span",ce," ?-? "))],2))}}),X=(s,t)=>{const e=s.__vccOpts||s;for(const[o,l]of t)e[o]=l;return e},pe=X(me,[["__scopeId","data-v-5485e28c"]]);let A;const he=new Uint8Array(16);function fe(){if(!A&&(A=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!A))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return A(he)}const T=[];for(let s=0;s<256;++s)T.push((s+256).toString(16).slice(1));function be(s,t=0){return T[s[t+0]]+T[s[t+1]]+T[s[t+2]]+T[s[t+3]]+"-"+T[s[t+4]]+T[s[t+5]]+"-"+T[s[t+6]]+T[s[t+7]]+"-"+T[s[t+8]]+T[s[t+9]]+"-"+T[s[t+10]]+T[s[t+11]]+T[s[t+12]]+T[s[t+13]]+T[s[t+14]]+T[s[t+15]]}const ve=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ee={randomUUID:ve};function ne(s,t,e){if(ee.randomUUID&&!t&&!s)return ee.randomUUID();s=s||{};const o=s.random||(s.rng||fe)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,t){e=e||0;for(let l=0;l<16;++l)t[e+l]=o[l];return t}return be(o)}const z=Q("players",()=>{const s=g([]);return{players:s,init:l=>{s.value=l.map(c=>({id:ne(),name:c}))},getName:l=>{var c;return((c=s.value.find(r=>r.id===l))==null?void 0:c.name)??l},clear:()=>s.value=[]}}),_e={class:"grid m-0"},ye={class:"col-5"},ge={class:"col-2 p-0"},xe={class:"col-5 text-right"},we=M({__name:"FixtureCard",props:{result:{}},emits:["showResultModal"],setup(s,{emit:t}){const e=s,o=t,l=z();return(c,r)=>(b(),_("div",_e,[a("div",ye,I(p(l).getName(e.result.scores[0].playerId)),1),a("div",ge,[v(pe,{result:e.result,onShowResultModal:r[0]||(r[0]=h=>o("showResultModal"))},null,8,["result"])]),a("div",xe,I(p(l).getName(e.result.scores[1].playerId)),1)]))}});class Re{constructor(t){N(this,"startTime");N(this,"finishTime");this.rounds=t,this.startTime=null,this.finishTime=null}start(){this.startTime=Date.now()}startFixture(t){for(const e of this.rounds)e.startFixture(t)}updateResult(t,e){for(const o of this.rounds)o.updateResult(t,e)}finish(){this.finishTime=Date.now()}}const W=Q("rounds",()=>{const s=g(),t=C(()=>{var n;return((n=s.value)==null?void 0:n.rounds)??[]}),e=C(()=>t.value.flatMap(n=>n.fixtures)),o=C(()=>e.value.filter(n=>n.startTime&&!n.finishTime).length),l=C(()=>e.value.filter(n=>!n.finishTime).length),c=C(()=>{const n=t.value.find(i=>i.fixtures.some(f=>!f.finishTime));return n?n.index:0}),r=C(()=>{var n;return((n=s.value)==null?void 0:n.startTime)??null}),h=C(()=>{var n;return((n=s.value)==null?void 0:n.finishTime)??null}),m=n=>t.value.find(i=>i.fixtures.some(f=>f.id===n)),u=n=>{s.value=new Re(n),s.value.start()};return{rounds:t,results:e,ongoingCount:o,remainingCount:l,currentRound:c,startTime:r,finishTime:h,getRound:m,start:u,startFixture:n=>{var i;(i=s.value)==null||i.startFixture(n)},updateResult:(n,i)=>{var f;(f=s.value)==null||f.updateResult(n,i)},finish:()=>{var n;(n=s.value)==null||n.finish()},clear:()=>u([])}});class Ce{constructor(t,e){N(this,"index");N(this,"name");N(this,"fixtures");this.index=t,this.name=e,this.fixtures=[]}addFixture(t){console.log(t.map(e=>e.name).join(" v ")),this.fixtures.push({id:ne(),scores:t.map(e=>({playerId:e.id,score:0})),startTime:null,finishTime:null})}startFixture(t){const e=this.fixtures.findIndex(o=>o.id===t);e>=0&&(this.fixtures[e].startTime=Date.now())}updateResult(t,e){const o=this.fixtures.findIndex(l=>l.id===t.id);o>=0&&(e&&(t.finishTime=Date.now()),this.fixtures[o]=t)}getExistingFixtures(t){return this.fixtures.filter(e=>e.scores.some(o=>o.playerId===t.id))}getExistingOpponents(t){const e=this.getExistingFixtures(t);return[...new Set(e.map(o=>o.scores.map(l=>l.playerId).filter(l=>l!==t.id)).flatMap(o=>o))]}}class K{constructor(t){N(this,"frameTimeEstimateMins",7);N(this,"generatedRounds");this.players=t}estimateDuration(t,e,o){const l=t*(t-1)/2,c=2*e-1,r=(e+c)/2,h=l*r;return Math.ceil(this.frameTimeEstimateMins*h/o)}generateFixtures(){if(this.generatedRounds!==void 0)throw"Fixtures have already been generated!";let t=0;const e=this.players.length%2!==0,o=e?this.players.length:this.players.length-1;this.generatedRounds=[];const l=this.shuffle(this.players.map((r,h)=>h));let c=0;for(;c<o&&t<10;){const r=new Ce(c+1,"Round "+(c+1));console.log(r.name);let h=!1,m=[...this.players];for(e&&(console.log("Omitting: "+m[l[c]].name),m.splice(l[c],1));m.length>1;){const u=this.getRandom(m),y=this.generatedRounds.flatMap(d=>d.getExistingOpponents(u)),F=m.filter(d=>!y.includes(d.id)&&u.id!==d.id);if(F.length<=0){console.log("Retrying round..."),h=!0;break}const S=this.getRandom(F);r.addFixture([u,S]),m=m.filter(d=>![u.id,S.id].includes(d.id))}if(h){t++;continue}this.generatedRounds.push(r),c++}return t>=10&&console.log("Failed to generate rounds after 10 attempts!"),this.generatedRounds}getCurrentRound(){if(this.generatedRounds===void 0)return 0;const t=this.generatedRounds.find(e=>e.fixtures.some(o=>!o.finishTime));return t?t.index:0}getRandom(t){return t[Math.floor(Math.random()*t.length)]}shuffle(t){let e=t.length,o=0;for(;e>0;){o=Math.floor(Math.random()*e),e--;const l=t[e];t[e]=t[o],t[o]=l}return t}}const Te="Player 1;Player 2;Player 3;Player 4";let j=[];j=String(Te).split(";");j.length<10&&(j=[...j,...new Array(10-j.length).fill("")]);const Z=Q("settings",()=>{const s=g(j.filter(w=>w).length),t=g(j),e=g(1),o=g(1),l=g("Round Robin"),c=g(["Round Robin"]),r=g(!1),h=g(!0),m=C(()=>t.value.slice(0,s.value)),u=C(()=>new K([]).estimateDuration(s.value,e.value,o.value)),y=C(()=>new K([]).frameTimeEstimateMins),F=C(()=>m.value.some(w=>!w)),S=w=>s.value=w,d=w=>t.value=w,n=(w,x)=>{t.value=t.value.map((R,P)=>P===w?x:R)},i=w=>e.value=w,f=w=>o.value=w;return{players:t,raceTo:e,tableCount:o,format:l,formatOptions:c,requireCompletedRounds:r,allowEarlyFinish:h,playerCount:s,estimatedDuration:u,durationPerFrame:y,actualPlayers:m,isInvalid:F,setPlayerCount:S,setPlayers:d,setName:n,setRaceTo:i,setTableCount:f,reset:()=>{i(1),f(1)}}}),Se={class:"flex flex-column md:flex-row md:align-items-center justify-content-between mb-2"},Fe={class:"font-bold"},Ie={class:"flex flex-column md:flex-row md:align-items-center justify-content-between mb-2"},$e={class:"font-bold"},ke={class:"md:ml-3"},Ve=a("span",{class:"pi pi-plus"},null,-1),Me=a("span",{class:"pi pi-minus"},null,-1),Be={class:"p-fluid"},Ne=M({__name:"RecordResultModal",props:{visible:{type:Boolean},result:{}},emits:["hide"],setup(s,{emit:t}){const e=s,o=t,l=Z(),c=z(),r=W(),h=g(e.visible),m=g(e.result.scores.map(x=>x.playerId)),u=g(e.result.scores.map(x=>x.score)),y=C(()=>r.getRound(e.result.id));Y([u],()=>{var x;(x=document.activeElement)==null||x.blur()}),Y(e,()=>{h.value=e.visible,m.value=e.result.scores.map(x=>x.playerId),u.value=e.result.scores.map(x=>x.score)});const F=(x,R)=>{u.value=u.value.map((P,B)=>B===x?R:P)},S=()=>{r.startFixture(e.result.id),o("hide")},d=x=>{const R={id:e.result.id,scores:m.value.map((P,B)=>({playerId:P,score:u.value[B]})),startTime:e.result.startTime};r.updateResult(R,x),o("hide")},n=C(()=>l.requireCompletedRounds?"Waiting for round to start":r.ongoingCount>=l.tableCount?"Waiting for a free table":"Start"),i=C(()=>l.requireCompletedRounds?y.value.index>r.currentRound:r.ongoingCount>=l.tableCount),f=C(()=>!!([...new Set(m.value)].length!==m.value.length||u.value.every(R=>R<l.raceTo))),L=C(()=>e.result.scores.map(x=>c.getName(x.playerId)).join(" v ")),w=C(()=>`${y.value.name} - ${L.value}`);return(x,R)=>{const P=$("InputNumber"),B=$("Button"),oe=$("Dialog");return b(),E(oe,{visible:h.value,"onUpdate:visible":R[3]||(R[3]=U=>h.value=U),modal:"",header:w.value,onHide:R[4]||(R[4]=U=>o("hide"))},{default:k(()=>[e.result.finishTime?(b(!0),_(V,{key:0},H(m.value,(U,q)=>(b(),_("div",Se,[a("div",Fe,I(p(c).getName(U))+": "+I(u.value[q]),1)]))),256)):e.result.startTime?(b(!0),_(V,{key:1},H(m.value,(U,q)=>(b(),_("div",Ie,[a("div",$e,I(p(c).getName(U)),1),a("div",ke,[v(P,{showButtons:"",buttonLayout:"horizontal",modelValue:u.value[q],min:0,max:p(l).raceTo,"onUpdate:modelValue":le=>F(q,le)},{incrementbuttonicon:k(()=>[Ve]),decrementbuttonicon:k(()=>[Me]),_:2},1032,["modelValue","max","onUpdate:modelValue"])])]))),256)):D("",!0),a("div",Be,[e.result.startTime?D("",!0):(b(),E(B,{key:0,class:"mb-2",type:"button",label:n.value,disabled:i.value,onClick:S},null,8,["label","disabled"])),e.result.startTime&&!e.result.finishTime?(b(),E(B,{key:1,class:"mb-2",type:"button",label:"Update",severity:"info",onClick:R[0]||(R[0]=()=>d(!1))})):D("",!0),e.result.startTime&&!e.result.finishTime?(b(),E(B,{key:2,class:"mb-2",type:"button",label:"Finish",disabled:f.value,onClick:R[1]||(R[1]=()=>d(!0))},null,8,["disabled"])):D("",!0),v(B,{type:"button",label:"Close",severity:"secondary",onClick:R[2]||(R[2]=U=>o("hide"))})])]),_:1},8,["visible","header"])}}}),De={class:"flex flex-column md:flex-row justify-content-between md:align-items-end border-bottom-1 pb-1"},Pe=a("h1",null,"Fixtures",-1),Ue={class:"text-center"},Ee=M({__name:"FixtureList",setup(s){const t=W(),e=g(),o=g(!1),l=r=>{e.value=r,o.value=!0},c=()=>{o.value=!1};return(r,h)=>(b(),_(V,null,[a("div",De,[Pe,a("h4",null,"Results remaining: "+I(p(t).remainingCount),1)]),(b(!0),_(V,null,H(p(t).rounds,(m,u)=>(b(),_("div",{class:O([u>0&&"border border-top-1"])},[a("h3",Ue,I(m.name),1),(b(!0),_(V,null,H(m.fixtures,(y,F)=>(b(),_("div",{class:O(["mt-1 pt-1 mb-1",[F>0&&"border-gray-200 border-top-1"]])},[v(we,{result:y,onShowResultModal:()=>l(y)},null,8,["result","onShowResultModal"])],2))),256))],2))),256)),e.value?(b(),E(Ne,{key:0,visible:o.value,result:e.value,onHide:c},null,8,["visible","result"])):D("",!0)],64))}}),je={class:"player-name-input p-fluid"},Le=M({__name:"PlayerNameInput",props:{name:{},placeholder:{},disabled:{type:Boolean}},emits:["setName"],setup(s,{emit:t}){const e=s,o=t;return(l,c)=>{const r=$("InputText");return b(),_("div",je,[v(r,{placeholder:e.placeholder,disabled:e.disabled,modelValue:e.name,"onUpdate:modelValue":c[0]||(c[0]=h=>o("setName",h||""))},null,8,["placeholder","disabled","modelValue"])])}}}),He=a("h1",{class:"border-bottom-1 mb-2"},"Format",-1),qe={class:"p-fluid mb-2"},Ae=a("span",{class:"pi pi-plus"},null,-1),Oe=a("span",{class:"pi pi-minus"},null,-1),ze={class:"p-fluid mb-2"},We=a("span",{class:"pi pi-plus"},null,-1),Ye=a("span",{class:"pi pi-minus"},null,-1),Ge={class:"p-fluid mb-2"},Je={class:"p-fluid flex justify-content-between mb-2"},Ke=a("label",{for:"requireCompletedRoundsCheckbox"},"Require completed rounds",-1),Qe={class:"p-fluid flex justify-content-between mb-2"},Xe=a("label",{for:"allowEarlyFinishCheckbox"},"Allow early finish",-1),Ze={class:"p-fluid border-top-1 mb-2"},et={class:"font-bold"},tt=a("h1",{class:"border-bottom-1 mb-2"},"Players",-1),st={class:"p-fluid mb-2"},nt=a("span",{class:"pi pi-plus"},null,-1),ot=a("span",{class:"pi pi-minus"},null,-1),lt={class:"p-fluid"},it=M({__name:"FlyerForm",emits:["start"],setup(s,{emit:t}){const e=Z(),o=t,l=g(!1);ae(()=>{const m=document.getElementsByClassName("p-inputnumber-button");for(const u of m)u.addEventListener("mouseup",()=>{var y;(y=document.activeElement)==null||y.blur()})});const c=()=>{l.value=!0},r=()=>{o("start"),h()},h=()=>{l.value=!1};return(m,u)=>{const y=$("InputNumber"),F=$("SelectButton"),S=$("Checkbox"),d=$("Button");return b(),_(V,null,[He,a("div",qe,[v(y,{modelValue:p(e).raceTo,"onUpdate:modelValue":u[0]||(u[0]=n=>p(e).raceTo=n),showButtons:"",buttonLayout:"horizontal",min:1,max:5,prefix:"Races to ",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:k(()=>[Ae]),decrementbuttonicon:k(()=>[Oe]),_:1},8,["modelValue"])]),a("div",ze,[v(y,{modelValue:p(e).tableCount,"onUpdate:modelValue":u[1]||(u[1]=n=>p(e).tableCount=n),showButtons:"",buttonLayout:"horizontal",min:1,max:Math.floor(p(e).playerCount/2),suffix:" table(s)",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:k(()=>[We]),decrementbuttonicon:k(()=>[Ye]),_:1},8,["modelValue","max"])]),a("div",Ge,[v(F,{modelValue:p(e).format,"onUpdate:modelValue":u[2]||(u[2]=n=>p(e).format=n),options:p(e).formatOptions,allowEmpty:!1,"aria-labelledby":"basic"},null,8,["modelValue","options"])]),a("div",Je,[Ke,v(S,{inputId:"requireCompletedRoundsCheckbox",modelValue:p(e).requireCompletedRounds,"onUpdate:modelValue":u[3]||(u[3]=n=>p(e).requireCompletedRounds=n),binary:!0},null,8,["modelValue"])]),a("div",Qe,[Xe,v(S,{inputId:"allowEarlyFinishCheckbox",modelValue:p(e).allowEarlyFinish,"onUpdate:modelValue":u[4]||(u[4]=n=>p(e).allowEarlyFinish=n),binary:!0},null,8,["modelValue"])]),a("div",Ze,[a("p",null,[G(" Estimated duration: "),a("span",et,I(p(e).estimatedDuration)+" min(s)",1),G(),a("em",null,"("+I(p(e).durationPerFrame)+" min(s) per frame)",1)])]),tt,a("div",st,[v(y,{modelValue:p(e).playerCount,"onUpdate:modelValue":u[5]||(u[5]=n=>p(e).playerCount=n),showButtons:"",buttonLayout:"horizontal",min:2,max:10,suffix:" players",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:k(()=>[nt]),decrementbuttonicon:k(()=>[ot]),_:1},8,["modelValue"])]),(b(!0),_(V,null,H(p(e).players,(n,i)=>(b(),_("div",null,[v(Le,{class:"mb-2",placeholder:"Player "+(i+1),disabled:i>=p(e).playerCount,name:n,onSetName:f=>p(e).setName(i,f)},null,8,["placeholder","disabled","name","onSetName"])]))),256)),a("div",lt,[v(d,{label:"Start",disabled:p(e).isInvalid,onClick:c},null,8,["disabled"])]),v(J,{visible:l.value,header:"Start Flyer",message:"Are you ready to start the flyer?",onConfirm:r,onHide:h},null,8,["visible"])],64)}}}),rt=s=>(te("data-v-6b223f2c"),s=s(),se(),s),at=rt(()=>a("h1",{class:"border-bottom-1"},"Results",-1)),ut={key:0},dt=M({__name:"ResultsTable",setup(s){const t=z(),e=W(),o=d=>!d.finishTime||l(d)?null:d.scores.reduce((i,f)=>i.score>f.score?i:f).playerId,l=d=>{if(!d.finishTime)return!1;const n=d.scores.map(i=>i.score).reduce((i,f)=>Math.max(i,f));return d.scores.every(i=>i.score===n)},c=d=>!d.finishTime||l(d)?null:d.scores.reduce((i,f)=>i.score<f.score?i:f).playerId,r=(d,n)=>n.filter(i=>o(i)===d).length,h=(d,n)=>n.filter(i=>l(i)&&i.scores.some(f=>f.playerId===d)).length,m=(d,n)=>n.filter(i=>c(i)===d).length,u=(d,n)=>n.some(i=>i.scores.some(f=>f.playerId===d)&&!i.finishTime),y=C(()=>t.players.map(n=>({name:n.name,wins:r(n.id,e.results),draws:h(n.id,e.results),losses:m(n.id,e.results),incomplete:u(n.id,e.results)})).sort((n,i)=>n.wins!==i.wins?i.wins-n.wins:n.losses!==i.losses?i.losses-n.losses:0)),F=d=>[{"bg-primary":!d.incomplete&&d.rank===1,"bg-gray-400":d.incomplete}],S=y.value.filter(d=>d.incomplete).length;return(d,n)=>{const i=$("Column"),f=$("DataTable");return b(),_(V,null,[at,a("p",null,"Started "+I(p(e).startTime),1),a("p",null,"Finished "+I(p(e).finishTime),1),v(f,{value:y.value,rowClass:F},{default:k(()=>[v(i,{header:"#"},{body:k(L=>[G(I(L.index+1),1)]),_:1}),v(i,{field:"name",header:"Name"}),v(i,{field:"wins",header:"Won"}),v(i,{field:"draws",header:"Drew"}),v(i,{field:"losses",header:"Lost"})]),_:1},8,["value"]),p(S)>0?(b(),_("h4",ut,[a("em",null,I(p(S))+" player(s) have incomplete results!",1)])):D("",!0)],64)}}}),ct=X(dt,[["__scopeId","data-v-6b223f2c"]]),mt=s=>(te("data-v-a7609a1f"),s=s(),se(),s),pt={key:0},ht={key:1},ft={class:"p-fluid mt-2"},bt={key:2},vt={class:"p-fluid mt-2"},_t=mt(()=>a("footer",null,[a("a",{href:"https://www.flaticon.com/free-icons/ball-eight",title:"ball eight icons"},"Ball eight icons created by Boris farias - Flaticon")],-1)),yt=M({__name:"HomeView",setup(s){const t=Z(),e=z(),o=W(),l=g(0),c=g("Fixtures"),r=g(!1),h=g(!1),m=f=>{l.value=f,window.scroll(0,0)},u=()=>{e.init(t.actualPlayers);const f=new K(e.players);o.start(f.generateFixtures()),m(1)},y=()=>{r.value=!0},F=()=>{o.finish(),m(2),S()},S=()=>{r.value=!1},d=()=>{h.value=!0},n=()=>{e.clear(),o.clear(),m(0),i()},i=()=>{h.value=!1};return(f,L)=>{const w=$("Button");return b(),_(V,null,[a("main",null,[l.value===0?(b(),_("div",pt,[v(it,{onStart:u})])):l.value===1?(b(),_("div",ht,[c.value==="Fixtures"?(b(),E(Ee,{key:0})):D("",!0),a("div",ft,[v(w,{label:"Finish",disabled:!p(t).allowEarlyFinish&&p(o).remainingCount>0,onClick:y},null,8,["disabled"])]),v(J,{visible:r.value,header:"Finish Flyer",message:"Are you ready to finish the flyer?",onConfirm:F,onHide:S},null,8,["visible"])])):l.value===2?(b(),_("div",bt,[v(ct),a("div",vt,[v(w,{label:"Restart",onClick:d})]),v(J,{visible:h.value,header:"Restart",message:"Are you sure you want to restart? All data for the current flyer will be lost!",onConfirm:n,onHide:i},null,8,["visible"])])):D("",!0)]),_t],64)}}}),wt=X(yt,[["__scopeId","data-v-a7609a1f"]]);export{wt as default};
