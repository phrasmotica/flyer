var se=Object.defineProperty;var ne=(s,t,e)=>t in s?se(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var j=(s,t,e)=>(ne(s,typeof t!="symbol"?t+"":t,e),e);import{d as U,r as w,w as Y,c as L,a as V,b as I,o as h,e as u,t as k,f as _,g,n as z,h as Q,u as D,i as $,j as A,F as B,k as E,l as oe,m as le,p as X,q as Z}from"./index-DdFEEVM4.js";const ae={class:"font-bold mb-2"},re={class:"p-fluid"},q=U({__name:"ConfirmModal",props:{visible:{type:Boolean},header:{},message:{}},emits:["confirm","cancel"],setup(s,{emit:t}){const e=s,o=t,n=w(e.visible);return Y(e,()=>{n.value=e.visible}),(a,i)=>{const d=I("Button"),m=I("Dialog");return h(),L(m,{visible:n.value,"onUpdate:visible":i[2]||(i[2]=r=>n.value=r),modal:"",header:e.header},{default:V(()=>[u("div",ae,k(e.message),1),u("div",re,[_(d,{class:"mb-2",type:"button",label:"Yes",onClick:i[0]||(i[0]=r=>o("confirm"))}),_(d,{type:"button",label:"No",severity:"secondary",onClick:i[1]||(i[1]=r=>o("cancel"))})])]),_:1},8,["visible","header"])}}}),ie={key:1},ue=U({__name:"ScoreCell",props:{result:{}},emits:["showResultModal"],setup(s,{emit:t}){const e=s,o=t,n=a=>a.finishTime?"bg-primary":a.startTime?"in-progress":"bg-cyan-100";return(a,i)=>(h(),g("div",{class:z(["p-2 text-center cursor-pointer border-round-md",n(e.result)]),onClick:i[0]||(i[0]=()=>o("showResultModal"))},[e.result.startTime?(h(),g("span",{key:0,class:z([e.result.finishTime&&"font-bold"])},k(e.result.scores.map(d=>d.score).join("-")),3)):(h(),g("span",ie," ?-? "))],2))}}),J=(s,t)=>{const e=s.__vccOpts||s;for(const[o,n]of t)e[o]=n;return e},ce=J(ue,[["__scopeId","data-v-a0880355"]]);let O;const de=new Uint8Array(16);function me(){if(!O&&(O=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!O))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return O(de)}const T=[];for(let s=0;s<256;++s)T.push((s+256).toString(16).slice(1));function pe(s,t=0){return T[s[t+0]]+T[s[t+1]]+T[s[t+2]]+T[s[t+3]]+"-"+T[s[t+4]]+T[s[t+5]]+"-"+T[s[t+6]]+T[s[t+7]]+"-"+T[s[t+8]]+T[s[t+9]]+"-"+T[s[t+10]]+T[s[t+11]]+T[s[t+12]]+T[s[t+13]]+T[s[t+14]]+T[s[t+15]]}const he=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),K={randomUUID:he};function ee(s,t,e){if(K.randomUUID&&!t&&!s)return K.randomUUID();s=s||{};const o=s.random||(s.rng||me)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,t){e=e||0;for(let n=0;n<16;++n)t[e+n]=o[n];return t}return pe(o)}const W=Q("players",()=>{const s=w([]);return{players:s,init:n=>{s.value=n.map(a=>({id:ee(),name:a}))},getName:n=>{var a;return((a=s.value.find(i=>i.id===n))==null?void 0:a.name)??n},clear:()=>s.value=[]}}),ve={class:"grid m-0"},fe={class:"col-5"},_e={class:"col-2 p-0"},be={class:"col-5 text-right"},ye=U({__name:"FixtureCard",props:{result:{}},emits:["showResultModal"],setup(s,{emit:t}){const e=s,o=t,n=W();return(a,i)=>(h(),g("div",ve,[u("div",fe,k(D(n).getName(e.result.scores[0].playerId)),1),u("div",_e,[_(ce,{result:e.result,onShowResultModal:i[0]||(i[0]=()=>o("showResultModal",e.result))},null,8,["result"])]),u("div",be,k(D(n).getName(e.result.scores[1].playerId)),1)]))}}),H=Q("rounds",()=>{const s=w([]),t=$(()=>s.value.flatMap(r=>r.fixtures)),e=$(()=>s.value.flatMap(r=>r.fixtures).filter(r=>!r.finishTime).length),o=$(()=>{const r=s.value.find(f=>f.fixtures.some(x=>!x.finishTime));return r?r.index:0}),n=r=>s.value.find(f=>f.fixtures.some(x=>x.id===r)),a=r=>s.value=r;return{rounds:s,results:t,remainingCount:e,currentRound:o,getRound:n,setRounds:a,startFixture:r=>{s.value=s.value.map(f=>f.startFixture(r))},updateResult:(r,f)=>{s.value=s.value.map(x=>x.updateResult(r,f))},clear:()=>a([])}}),ge={class:"flex flex-column md:flex-row md:align-items-center justify-content-between mb-2"},xe={class:"font-bold"},we={class:"flex flex-column md:flex-row md:align-items-center justify-content-between mb-2"},Re={class:"font-bold"},Se={class:"md:ml-3"},Te=u("span",{class:"pi pi-plus"},null,-1),Ce=u("span",{class:"pi pi-minus"},null,-1),Fe={class:"p-fluid"},$e=U({__name:"RecordResultModal",props:{visible:{type:Boolean},round:{},result:{},raceTo:{}},emits:["cancel","start","confirm"],setup(s,{emit:t}){const e=s,o=t,n=W(),a=H(),i=w(e.visible),d=w(e.result.scores.map(p=>p.playerId)),m=w(e.result.scores.map(p=>p.score));Y([m],()=>{var p;(p=document.activeElement)==null||p.blur()}),Y(e,()=>{i.value=e.visible,d.value=e.result.scores.map(p=>p.playerId),m.value=e.result.scores.map(p=>p.score)});const r=(p,b)=>{m.value=m.value.map((N,F)=>F===p?b:N)},f=()=>o("start"),x=p=>{const b={id:e.result.id,scores:d.value.map((N,F)=>({playerId:N,score:m.value[F]})),startTime:e.result.startTime};o("confirm",b,p)},R=$(()=>e.round.index>a.currentRound?"Waiting for round to start":"Start"),l=$(()=>e.round.index>a.currentRound),v=$(()=>!!([...new Set(d.value)].length!==d.value.length||m.value.every(b=>b<e.raceTo))),c=$(()=>e.result.scores.map(p=>n.getName(p.playerId)).join(" v ")),y=$(()=>`${e.round.name} - ${c.value}`);return(p,b)=>{const N=I("InputNumber"),F=I("Button"),C=I("Dialog");return h(),L(C,{visible:i.value,"onUpdate:visible":b[3]||(b[3]=S=>i.value=S),modal:"",header:y.value},{default:V(()=>[e.result.finishTime?(h(!0),g(B,{key:0},A(d.value,(S,M)=>(h(),g("div",ge,[u("div",xe,k(D(n).getName(S))+": "+k(m.value[M]),1)]))),256)):e.result.startTime?(h(!0),g(B,{key:1},A(d.value,(S,M)=>(h(),g("div",we,[u("div",Re,k(D(n).getName(S)),1),u("div",Se,[_(N,{showButtons:"",buttonLayout:"horizontal",modelValue:m.value[M],min:0,max:e.raceTo,"onUpdate:modelValue":P=>r(M,P)},{incrementbuttonicon:V(()=>[Te]),decrementbuttonicon:V(()=>[Ce]),_:2},1032,["modelValue","max","onUpdate:modelValue"])])]))),256)):E("",!0),u("div",Fe,[e.result.startTime?E("",!0):(h(),L(F,{key:0,class:"mb-2",type:"button",label:R.value,disabled:l.value,onClick:f},null,8,["label","disabled"])),e.result.startTime&&!e.result.finishTime?(h(),L(F,{key:1,class:"mb-2",type:"button",label:"Update",severity:"info",onClick:b[0]||(b[0]=()=>x(!1))})):E("",!0),e.result.startTime&&!e.result.finishTime?(h(),L(F,{key:2,class:"mb-2",type:"button",label:"Finish",disabled:v.value,onClick:b[1]||(b[1]=()=>x(!0))},null,8,["disabled"])):E("",!0),_(F,{type:"button",label:"Close",severity:"secondary",onClick:b[2]||(b[2]=S=>o("cancel"))})])]),_:1},8,["visible","header"])}}}),Ie={class:"flex flex-column md:flex-row justify-content-between md:align-items-end border-bottom-1 pb-1"},ke=u("h1",null,"Fixtures",-1),Me={class:"text-center"},Ve=U({__name:"FixtureList",props:{raceTo:{}},setup(s){const t=s,e=H(),o=$(()=>{var f;return e.getRound(((f=n.value)==null?void 0:f.id)||"")}),n=w(),a=w(!1),i=f=>{n.value=f,a.value=!0},d=()=>{n.value&&(e.startFixture(n.value.id),r())},m=(f,x)=>{e.updateResult(f,x),r()},r=()=>{a.value=!1};return(f,x)=>(h(),g(B,null,[u("div",Ie,[ke,u("h4",null,"Results remaining: "+k(D(e).remainingCount),1)]),(h(!0),g(B,null,A(D(e).rounds,(R,l)=>(h(),g("div",{class:z([l>0&&"border border-top-1"])},[u("h3",Me,k(R.name),1),(h(!0),g(B,null,A(R.fixtures,(v,c)=>(h(),g("div",{class:z(["mt-1 pt-1 mb-1",[c>0&&"border-gray-200 border-top-1"]])},[_(ye,{result:v,onShowResultModal:()=>i(v)},null,8,["result","onShowResultModal"])],2))),256))],2))),256)),o.value&&n.value?(h(),L($e,{key:0,visible:a.value,round:o.value,result:n.value,raceTo:t.raceTo,onStart:d,onConfirm:m,onCancel:r},null,8,["visible","round","result","raceTo"])):E("",!0)],64))}}),Ne={class:"player-name-input p-fluid"},Be=U({__name:"PlayerNameInput",props:{name:{},placeholder:{},disabled:{type:Boolean}},emits:["setName"],setup(s,{emit:t}){const e=s,o=t;return(n,a)=>{const i=I("InputText");return h(),g("div",Ne,[_(i,{placeholder:e.placeholder,disabled:e.disabled,modelValue:e.name,"onUpdate:modelValue":a[0]||(a[0]=d=>o("setName",d||""))},null,8,["placeholder","disabled","modelValue"])])}}});class G{constructor(t){j(this,"frameTimeEstimateMins",7);j(this,"generatedRounds");this.players=t}estimateDuration(t,e,o){const n=t*(t-1)/2,a=2*e-1,i=(e+a)/2,d=n*i;return Math.ceil(this.frameTimeEstimateMins*d/o)}generateFixtures(){if(this.generatedRounds!==void 0)throw"Fixtures have already been generated!";let t=0;const e=this.players.length%2!==0,o=e?this.players.length:this.players.length-1;this.generatedRounds=[];const n=this.shuffle(this.players.map((i,d)=>d));let a=0;for(;a<o&&t<10;){const i=new De(a+1,"Round "+(a+1));console.log(i.name);let d=!1,m=[...this.players];for(e&&(console.log("Omitting: "+m[n[a]].name),m.splice(n[a],1));m.length>1;){const r=this.getRandom(m),f=this.generatedRounds.flatMap(l=>l.getExistingOpponents(r)),x=m.filter(l=>!f.includes(l.id)&&r.id!==l.id);if(x.length<=0){console.log("Retrying round..."),d=!0;break}const R=this.getRandom(x);i.addFixture([r,R]),m=m.filter(l=>![r.id,R.id].includes(l.id))}if(d){t++;continue}this.generatedRounds.push(i),a++}return t>=10&&console.log("Failed to generate rounds after 10 attempts!"),this.generatedRounds}getCurrentRound(){if(this.generatedRounds===void 0)return 0;const t=this.generatedRounds.find(e=>e.fixtures.some(o=>!o.finishTime));return t?t.index:0}getRandom(t){return t[Math.floor(Math.random()*t.length)]}shuffle(t){let e=t.length,o=0;for(;e>0;){o=Math.floor(Math.random()*e),e--;const n=t[e];t[e]=t[o],t[o]=n}return t}}class De{constructor(t,e){j(this,"index");j(this,"name");j(this,"fixtures");this.index=t,this.name=e,this.fixtures=[]}addFixture(t){console.log(t.map(e=>e.name).join(" v ")),this.fixtures.push({id:ee(),scores:t.map(e=>({playerId:e.id,score:0})),startTime:null,finishTime:null})}startFixture(t){const e=this.fixtures.findIndex(o=>o.id===t);return e>=0&&(this.fixtures[e].startTime=Date.now()),this}updateResult(t,e){const o=this.fixtures.findIndex(n=>n.id===t.id);return o>=0&&(e&&(t.finishTime=Date.now()),this.fixtures[o]=t),this}getExistingFixtures(t){return this.fixtures.filter(e=>e.scores.some(o=>o.playerId===t.id))}getExistingOpponents(t){const e=this.getExistingFixtures(t);return[...new Set(e.map(o=>o.scores.map(n=>n.playerId).filter(n=>n!==t.id)).flatMap(o=>o))]}}const Ue=u("h1",{class:"border-bottom-1 mb-2"},"Format",-1),Pe={class:"p-fluid mb-2"},Ee=u("span",{class:"pi pi-plus"},null,-1),Le=u("span",{class:"pi pi-minus"},null,-1),je={class:"p-fluid mb-2"},Ae=u("span",{class:"pi pi-plus"},null,-1),Oe=u("span",{class:"pi pi-minus"},null,-1),ze={class:"p-fluid mb-2"},We={class:"p-fluid mb-2"},He=u("h1",{class:"border-bottom-1 mb-2"},"Players",-1),Ye={class:"p-fluid mb-2"},qe=u("span",{class:"pi pi-plus"},null,-1),Ge=u("span",{class:"pi pi-minus"},null,-1),Je={class:"p-fluid"},Ke=U({__name:"FlyerForm",props:{players:{}},emits:["start","setName","reset"],setup(s,{emit:t}){const e=s,o=t,n=w(e.players.filter(y=>y).length),a=w("Round Robin"),i=w(["Round Robin"]),d=w(1),m=w(1),r=w(!1),f=$(()=>new G([]).estimateDuration(n.value,d.value,m.value)),x=new G([]).frameTimeEstimateMins;oe(()=>{const y=document.getElementsByClassName("p-inputnumber-button");for(const p of y)p.addEventListener("mouseup",()=>{var b;(b=document.activeElement)==null||b.blur()})});const R=$(()=>e.players.slice(0,n.value)),l=()=>{r.value=!0},v=()=>{o("start",R.value,d.value,m.value),c()},c=()=>{r.value=!1};return(y,p)=>{const b=I("InputNumber"),N=I("SelectButton"),F=I("Button");return h(),g(B,null,[Ue,u("div",Pe,[_(b,{modelValue:d.value,"onUpdate:modelValue":p[0]||(p[0]=C=>d.value=C),showButtons:"",buttonLayout:"horizontal",min:1,max:5,prefix:"Races to ",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:V(()=>[Ee]),decrementbuttonicon:V(()=>[Le]),_:1},8,["modelValue"])]),u("div",je,[_(b,{modelValue:m.value,"onUpdate:modelValue":p[1]||(p[1]=C=>m.value=C),showButtons:"",buttonLayout:"horizontal",min:1,max:Math.floor(n.value/2),suffix:" table(s)",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:V(()=>[Ae]),decrementbuttonicon:V(()=>[Oe]),_:1},8,["modelValue","max"])]),u("div",ze,[_(N,{modelValue:a.value,"onUpdate:modelValue":p[2]||(p[2]=C=>a.value=C),options:i.value,allowEmpty:!1,"aria-labelledby":"basic"},null,8,["modelValue","options"])]),u("div",We,[u("p",null,[le("Estimated duration: "+k(f.value)+" min(s) ",1),u("em",null,"("+k(D(x))+" min(s) per frame)",1)])]),He,u("div",Ye,[_(b,{modelValue:n.value,"onUpdate:modelValue":p[3]||(p[3]=C=>n.value=C),showButtons:"",buttonLayout:"horizontal",min:2,max:10,suffix:" players",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:V(()=>[qe]),decrementbuttonicon:V(()=>[Ge]),_:1},8,["modelValue"])]),(h(!0),g(B,null,A(y.players,(C,S)=>(h(),g("div",null,[_(Be,{class:"mb-2",placeholder:"Player "+(S+1),disabled:S>=n.value,name:C,onSetName:M=>o("setName",S,M)},null,8,["placeholder","disabled","name","onSetName"])]))),256)),u("div",Je,[_(F,{label:"Start",disabled:R.value.some(C=>!C),onClick:l},null,8,["disabled"])]),_(q,{visible:r.value,header:"Start Flyer",message:"Are you ready to start the flyer?",onConfirm:v,onCancel:c},null,8,["visible"])],64)}}}),Qe=s=>(X("data-v-9f0983d7"),s=s(),Z(),s),Xe=Qe(()=>u("h1",{class:"border-bottom-1"},"Results",-1)),Ze={key:0},et=U({__name:"ResultsTable",setup(s){const t=W(),e=H(),o=l=>!l.finishTime||n(l)?null:l.scores.reduce((c,y)=>c.score>y.score?c:y).playerId,n=l=>{if(!l.finishTime)return!1;const v=l.scores.map(c=>c.score).reduce((c,y)=>Math.max(c,y));return l.scores.every(c=>c.score===v)},a=l=>!l.finishTime||n(l)?null:l.scores.reduce((c,y)=>c.score<y.score?c:y).playerId,i=(l,v)=>v.filter(c=>o(c)===l).length,d=(l,v)=>v.filter(c=>n(c)&&c.scores.some(y=>y.playerId===l)).length,m=(l,v)=>v.filter(c=>a(c)===l).length,r=(l,v)=>v.some(c=>c.scores.some(y=>y.playerId===l)&&!c.finishTime),f=$(()=>t.players.map((l,v)=>({rank:v+1,name:l.name,wins:i(l.id,e.results),draws:d(l.id,e.results),losses:m(l.id,e.results),incomplete:r(l.id,e.results)})).sort((l,v)=>l.wins!==v.wins?v.wins-l.wins:l.losses!==v.losses?v.losses-l.losses:0)),x=l=>[{"bg-primary":!l.incomplete&&l.rank===1,"bg-gray-400":l.incomplete}],R=f.value.filter(l=>l.incomplete).length;return(l,v)=>{const c=I("Column"),y=I("DataTable");return h(),g(B,null,[Xe,_(y,{value:f.value,rowClass:x},{default:V(()=>[_(c,{field:"rank",header:"#"}),_(c,{field:"name",header:"Name"}),_(c,{field:"wins",header:"Won"}),_(c,{field:"draws",header:"Drew"}),_(c,{field:"losses",header:"Lost"})]),_:1},8,["value"]),D(R)>0?(h(),g("h4",Ze,[u("em",null,k(D(R))+" player(s) have incomplete results!",1)])):E("",!0)],64)}}}),tt=J(et,[["__scopeId","data-v-9f0983d7"]]),st=s=>(X("data-v-64646b19"),s=s(),Z(),s),nt={key:0},ot={key:1},lt={class:"p-fluid mt-2"},at={key:2},rt={class:"p-fluid mt-2"},it=st(()=>u("footer",null,[u("a",{href:"https://www.flaticon.com/free-icons/ball-eight",title:"ball eight icons"},"Ball eight icons created by Boris farias - Flaticon")],-1)),ut=U({__name:"HomeView",setup(s){const t="Player 1;Player 2;Player 3;Player 4";let e=[];e=String(t).split(";"),e.length<10&&(e=[...e,...new Array(10-e.length).fill("")]);const o=w(0),n=w(e),a=W(),i=w(0),d=w(0);let m;const r=H(),f=w("Fixtures"),x=w(!1),R=w(!1),l=S=>o.value=S,v=(S,M)=>{n.value=n.value.map((P,te)=>te===S?M:P)},c=(S,M,P)=>{a.init(S),i.value=M,d.value=P,m=new G(a.players),r.setRounds(m.generateFixtures()),l(1)},y=()=>{x.value=!0},p=()=>{l(2),b()},b=()=>{x.value=!1},N=()=>{R.value=!0},F=()=>{l(0),a.clear(),i.value=0,r.clear()},C=()=>{R.value=!1};return(S,M)=>{const P=I("Button");return h(),g(B,null,[u("main",null,[o.value===0?(h(),g("div",nt,[_(Ke,{players:n.value,onSetName:v,onStart:c},null,8,["players"])])):o.value===1?(h(),g("div",ot,[f.value==="Fixtures"?(h(),L(Ve,{key:0,raceTo:i.value},null,8,["raceTo"])):E("",!0),u("div",lt,[_(P,{label:"Finish",onClick:y})]),_(q,{visible:x.value,header:"Finish Flyer",message:"Are you ready to finish the flyer?",onConfirm:p,onCancel:b},null,8,["visible"])])):o.value===2?(h(),g("div",at,[_(tt),u("div",rt,[_(P,{label:"Restart",onClick:N})]),_(q,{visible:R.value,header:"Restart",message:"Are you sure you want to restart? All data for the current flyer will be lost!",onConfirm:F,onCancel:C},null,8,["visible"])])):E("",!0)]),it],64)}}}),mt=J(ut,[["__scopeId","data-v-64646b19"]]);export{mt as default};
