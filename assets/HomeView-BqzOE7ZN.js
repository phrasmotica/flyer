var se=Object.defineProperty;var ne=(n,t,e)=>t in n?se(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var j=(n,t,e)=>(ne(n,typeof t!="symbol"?t+"":t,e),e);import{d as P,r as x,w as Y,c as L,a as M,b as I,o as m,e as c,t as S,f as v,g as b,n as W,h as F,i as O,F as B,j as E,k as oe,l as le,u as H,p as X,m as Z}from"./index-DkGoyTKX.js";let z;const ae=new Uint8Array(16);function re(){if(!z&&(z=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!z))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return z(ae)}const w=[];for(let n=0;n<256;++n)w.push((n+256).toString(16).slice(1));function ie(n,t=0){return w[n[t+0]]+w[n[t+1]]+w[n[t+2]]+w[n[t+3]]+"-"+w[n[t+4]]+w[n[t+5]]+"-"+w[n[t+6]]+w[n[t+7]]+"-"+w[n[t+8]]+w[n[t+9]]+"-"+w[n[t+10]]+w[n[t+11]]+w[n[t+12]]+w[n[t+13]]+w[n[t+14]]+w[n[t+15]]}const ue=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Q={randomUUID:ue};function ee(n,t,e){if(Q.randomUUID&&!t&&!n)return Q.randomUUID();n=n||{};const o=n.random||(n.rng||re)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,t){e=e||0;for(let l=0;l<16;++l)t[e+l]=o[l];return t}return ie(o)}const ce={class:"font-bold mb-2"},de={class:"p-fluid"},G=P({__name:"ConfirmModal",props:{visible:{type:Boolean},header:{},message:{}},emits:["confirm","cancel"],setup(n,{emit:t}){const e=n,o=t,l=x(e.visible);return Y(e,()=>{l.value=e.visible}),(i,u)=>{const d=I("Button"),f=I("Dialog");return m(),L(f,{visible:l.value,"onUpdate:visible":u[2]||(u[2]=p=>l.value=p),modal:"",header:e.header},{default:M(()=>[c("div",ce,S(e.message),1),c("div",de,[v(d,{class:"mb-2",type:"button",label:"Yes",onClick:u[0]||(u[0]=p=>o("confirm"))}),v(d,{type:"button",label:"No",severity:"secondary",onClick:u[1]||(u[1]=p=>o("cancel"))})])]),_:1},8,["visible","header"])}}}),me={key:1},pe=P({__name:"ScoreCell",props:{result:{}},emits:["showResultModal"],setup(n,{emit:t}){const e=n,o=t,l=i=>i.finishTime?"bg-primary":i.startTime?"in-progress":"bg-cyan-100";return(i,u)=>(m(),b("div",{class:W(["p-2 text-center cursor-pointer border-round-md",l(e.result)]),onClick:u[0]||(u[0]=()=>o("showResultModal"))},[e.result.startTime?(m(),b("span",{key:0,class:W([e.result.finishTime&&"font-bold"])},S(e.result.scores.map(d=>d.score).join("-")),3)):(m(),b("span",me," ?-? "))],2))}}),K=(n,t)=>{const e=n.__vccOpts||n;for(const[o,l]of t)e[o]=l;return e},he=K(pe,[["__scopeId","data-v-a0880355"]]),ve={class:"grid m-0"},fe={class:"col-5"},_e={class:"col-2 p-0"},ye={class:"col-5 text-right"},be=P({__name:"FixtureCard",props:{players:{},result:{}},emits:["showResultModal"],setup(n,{emit:t}){const e=n,o=t,l=i=>{var u;return((u=e.players.find(d=>d.id===i))==null?void 0:u.name)??i};return(i,u)=>(m(),b("div",ve,[c("div",fe,S(l(e.result.scores[0].playerId)),1),c("div",_e,[v(he,{result:e.result,onShowResultModal:u[0]||(u[0]=()=>o("showResultModal",e.result))},null,8,["result"])]),c("div",ye,S(l(e.result.scores[1].playerId)),1)]))}}),ge={class:"flex flex-column md:flex-row md:align-items-center justify-content-between mb-2"},xe={class:"font-bold"},Re={class:"flex flex-column md:flex-row md:align-items-center justify-content-between mb-2"},we={class:"font-bold"},Te={class:"md:ml-3"},$e=c("span",{class:"pi pi-plus"},null,-1),Ce=c("span",{class:"pi pi-minus"},null,-1),Fe={class:"p-fluid"},Ie=P({__name:"RecordResultModal",props:{visible:{type:Boolean},players:{},currentRound:{},round:{},result:{},raceTo:{}},emits:["cancel","start","confirm"],setup(n,{emit:t}){const e=n,o=t,l=x(e.visible),i=x(e.result.scores.map(s=>s.playerId)),u=x(e.result.scores.map(s=>s.score));Y([u],()=>{var s;(s=document.activeElement)==null||s.blur()}),Y(e,()=>{l.value=e.visible,i.value=e.result.scores.map(s=>s.playerId),u.value=e.result.scores.map(s=>s.score)});const d=(s,r)=>{u.value=u.value.map((R,$)=>$===s?r:R)},f=()=>o("start"),p=s=>{const r={id:e.result.id,scores:i.value.map((R,$)=>({playerId:R,score:u.value[$]})),startTime:e.result.startTime};o("confirm",r,s)},k=F(()=>e.round.index>e.currentRound?"Waiting for round to start":"Start"),T=F(()=>e.round.index>e.currentRound),_=F(()=>!!([...new Set(i.value)].length!==i.value.length||u.value.every(r=>r<e.raceTo))),y=s=>{var r;return(r=e.players.find(R=>R.id===s))==null?void 0:r.name},a=F(()=>e.result.scores.map(s=>y(s.playerId)).join(" v ")),h=F(()=>`${e.round.name} - ${a.value}`);return(s,r)=>{const R=I("InputNumber"),$=I("Button"),N=I("Dialog");return m(),L(N,{visible:l.value,"onUpdate:visible":r[3]||(r[3]=g=>l.value=g),modal:"",header:h.value},{default:M(()=>[e.result.finishTime?(m(!0),b(B,{key:0},O(i.value,(g,V)=>(m(),b("div",ge,[c("div",xe,S(y(g))+": "+S(u.value[V]),1)]))),256)):e.result.startTime?(m(!0),b(B,{key:1},O(i.value,(g,V)=>(m(),b("div",Re,[c("div",we,S(y(g)),1),c("div",Te,[v(R,{showButtons:"",buttonLayout:"horizontal",modelValue:u.value[V],min:0,max:e.raceTo,"onUpdate:modelValue":A=>d(V,A)},{incrementbuttonicon:M(()=>[$e]),decrementbuttonicon:M(()=>[Ce]),_:2},1032,["modelValue","max","onUpdate:modelValue"])])]))),256)):E("",!0),c("div",Fe,[e.result.startTime?E("",!0):(m(),L($,{key:0,class:"mb-2",type:"button",label:k.value,disabled:T.value,onClick:f},null,8,["label","disabled"])),e.result.startTime&&!e.result.finishTime?(m(),L($,{key:1,class:"mb-2",type:"button",label:"Update",severity:"info",onClick:r[0]||(r[0]=()=>p(!1))})):E("",!0),e.result.startTime&&!e.result.finishTime?(m(),L($,{key:2,class:"mb-2",type:"button",label:"Finish",disabled:_.value,onClick:r[1]||(r[1]=()=>p(!0))},null,8,["disabled"])):E("",!0),v($,{type:"button",label:"Close",severity:"secondary",onClick:r[2]||(r[2]=g=>o("cancel"))})])]),_:1},8,["visible","header"])}}}),Se={class:"flex flex-column md:flex-row justify-content-between md:align-items-end border-bottom-1 pb-1"},ke=c("h1",null,"Fixtures",-1),Me={class:"text-center"},Ve=P({__name:"FixtureList",props:{players:{},raceTo:{},currentRound:{},rounds:{}},emits:["start","updateResult"],setup(n,{emit:t}){const e=n,o=t,l=x(),i=x(!1),u=F(()=>e.rounds.flatMap(_=>_.fixtures).filter(_=>!_.finishTime).length),d=F(()=>e.rounds.find(_=>_.fixtures.some(y=>{var a;return y.id===((a=l.value)==null?void 0:a.id)}))),f=_=>{l.value=_,i.value=!0},p=()=>{l.value&&(o("start",l.value.id),T())},k=(_,y)=>{o("updateResult",_,y),T()},T=()=>{i.value=!1};return(_,y)=>(m(),b(B,null,[c("div",Se,[ke,c("h4",null,"Results remaining: "+S(u.value),1)]),(m(!0),b(B,null,O(e.rounds,(a,h)=>(m(),b("div",{class:W([h>0&&"border border-top-1"])},[c("h3",Me,S(a.name),1),(m(!0),b(B,null,O(a.fixtures,(s,r)=>(m(),b("div",{class:W(["mt-1 pt-1 mb-1",[r>0&&"border-gray-200 border-top-1"]])},[v(be,{players:e.players,result:s,onShowResultModal:()=>f(s)},null,8,["players","result","onShowResultModal"])],2))),256))],2))),256)),d.value&&l.value?(m(),L(Ie,{key:0,visible:i.value,players:e.players,currentRound:e.currentRound,round:d.value,result:l.value,raceTo:e.raceTo,onStart:p,onConfirm:k,onCancel:T},null,8,["visible","players","currentRound","round","result","raceTo"])):E("",!0)],64))}}),Be={class:"player-name-input p-fluid"},Pe=P({__name:"PlayerNameInput",props:{name:{},placeholder:{},disabled:{type:Boolean}},emits:["setName"],setup(n,{emit:t}){const e=n,o=t;return(l,i)=>{const u=I("InputText");return m(),b("div",Be,[v(u,{placeholder:e.placeholder,disabled:e.disabled,modelValue:e.name,"onUpdate:modelValue":i[0]||(i[0]=d=>o("setName",d||""))},null,8,["placeholder","disabled","modelValue"])])}}});class J{constructor(t){j(this,"frameTimeEstimateMins",7);j(this,"generatedRounds");this.players=t}estimateDuration(t,e,o){const l=t*(t-1)/2,i=2*e-1,u=(e+i)/2,d=l*u;return Math.ceil(this.frameTimeEstimateMins*d/o)}generateFixtures(){if(this.generatedRounds!==void 0)throw"Fixtures have already been generated!";let t=0;const e=this.players.length%2!==0,o=e?this.players.length:this.players.length-1;this.generatedRounds=[];const l=this.shuffle(this.players.map((u,d)=>d));let i=0;for(;i<o&&t<10;){const u=new Ne(i+1,"Round "+(i+1));console.log(u.name);let d=!1,f=[...this.players];for(e&&(console.log("Omitting: "+f[l[i]].name),f.splice(l[i],1));f.length>1;){const p=this.getRandom(f),k=this.generatedRounds.flatMap(y=>y.getExistingOpponents(p)),T=f.filter(y=>!k.includes(y.id)&&p.id!==y.id);if(T.length<=0){console.log("Retrying round..."),d=!0;break}const _=this.getRandom(T);u.addFixture([p,_]),f=f.filter(y=>![p.id,_.id].includes(y.id))}if(d){t++;continue}this.generatedRounds.push(u),i++}return t>=10&&console.log("Failed to generate rounds after 10 attempts!"),this.generatedRounds}getCurrentRound(){if(this.generatedRounds===void 0)return 0;const t=this.generatedRounds.find(e=>e.fixtures.some(o=>!o.finishTime));return t?t.index:0}getRandom(t){return t[Math.floor(Math.random()*t.length)]}shuffle(t){let e=t.length,o=0;for(;e>0;){o=Math.floor(Math.random()*e),e--;const l=t[e];t[e]=t[o],t[o]=l}return t}}class Ne{constructor(t,e){j(this,"index");j(this,"name");j(this,"fixtures");this.index=t,this.name=e,this.fixtures=[]}addFixture(t){console.log(t.map(e=>e.name).join(" v ")),this.fixtures.push({id:ee(),scores:t.map(e=>({playerId:e.id,score:0})),startTime:null,finishTime:null})}startFixture(t){const e=this.fixtures.findIndex(o=>o.id===t);return e>=0&&(this.fixtures[e].startTime=Date.now()),this}updateResult(t,e){const o=this.fixtures.findIndex(l=>l.id===t.id);return o>=0&&(e&&(t.finishTime=Date.now()),this.fixtures[o]=t),this}getExistingFixtures(t){return this.fixtures.filter(e=>e.scores.some(o=>o.playerId===t.id))}getExistingOpponents(t){const e=this.getExistingFixtures(t);return[...new Set(e.map(o=>o.scores.map(l=>l.playerId).filter(l=>l!==t.id)).flatMap(o=>o))]}}const Ue=c("h1",{class:"border-bottom-1 mb-2"},"Format",-1),De={class:"p-fluid mb-2"},Ee=c("span",{class:"pi pi-plus"},null,-1),Le=c("span",{class:"pi pi-minus"},null,-1),je={class:"p-fluid mb-2"},Ae=c("span",{class:"pi pi-plus"},null,-1),Oe=c("span",{class:"pi pi-minus"},null,-1),ze={class:"p-fluid mb-2"},We={class:"p-fluid mb-2"},He=c("h1",{class:"border-bottom-1 mb-2"},"Players",-1),qe={class:"p-fluid mb-2"},Ye=c("span",{class:"pi pi-plus"},null,-1),Ge=c("span",{class:"pi pi-minus"},null,-1),Je={class:"p-fluid"},Ke=P({__name:"FlyerForm",props:{players:{}},emits:["start","setName","reset"],setup(n,{emit:t}){const e=n,o=t,l=x(e.players.filter(s=>s).length),i=x("Round Robin"),u=x(["Round Robin"]),d=x(1),f=x(1),p=x(!1),k=F(()=>new J([]).estimateDuration(l.value,d.value,f.value)),T=new J([]).frameTimeEstimateMins;oe(()=>{const s=document.getElementsByClassName("p-inputnumber-button");for(const r of s)r.addEventListener("mouseup",()=>{var R;(R=document.activeElement)==null||R.blur()})});const _=F(()=>e.players.slice(0,l.value)),y=()=>{p.value=!0},a=()=>{o("start",_.value,d.value,f.value),h()},h=()=>{p.value=!1};return(s,r)=>{const R=I("InputNumber"),$=I("SelectButton"),N=I("Button");return m(),b(B,null,[Ue,c("div",De,[v(R,{modelValue:d.value,"onUpdate:modelValue":r[0]||(r[0]=g=>d.value=g),showButtons:"",buttonLayout:"horizontal",min:1,max:5,prefix:"Races to ",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:M(()=>[Ee]),decrementbuttonicon:M(()=>[Le]),_:1},8,["modelValue"])]),c("div",je,[v(R,{modelValue:f.value,"onUpdate:modelValue":r[1]||(r[1]=g=>f.value=g),showButtons:"",buttonLayout:"horizontal",min:1,max:Math.floor(l.value/2),suffix:" table(s)",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:M(()=>[Ae]),decrementbuttonicon:M(()=>[Oe]),_:1},8,["modelValue","max"])]),c("div",ze,[v($,{modelValue:i.value,"onUpdate:modelValue":r[2]||(r[2]=g=>i.value=g),options:u.value,allowEmpty:!1,"aria-labelledby":"basic"},null,8,["modelValue","options"])]),c("div",We,[c("p",null,[le("Estimated duration: "+S(k.value)+" min(s) ",1),c("em",null,"("+S(H(T))+" min(s) per frame)",1)])]),He,c("div",qe,[v(R,{modelValue:l.value,"onUpdate:modelValue":r[3]||(r[3]=g=>l.value=g),showButtons:"",buttonLayout:"horizontal",min:2,max:10,suffix:" players",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:M(()=>[Ye]),decrementbuttonicon:M(()=>[Ge]),_:1},8,["modelValue"])]),(m(!0),b(B,null,O(s.players,(g,V)=>(m(),b("div",null,[v(Pe,{class:"mb-2",placeholder:"Player "+(V+1),disabled:V>=l.value,name:g,onSetName:A=>o("setName",V,A)},null,8,["placeholder","disabled","name","onSetName"])]))),256)),c("div",Je,[v(N,{label:"Start",disabled:_.value.some(g=>!g),onClick:y},null,8,["disabled"])]),v(G,{visible:p.value,header:"Start Flyer",message:"Are you ready to start the flyer?",onConfirm:a,onCancel:h},null,8,["visible"])],64)}}}),Qe=n=>(X("data-v-93c0b17a"),n=n(),Z(),n),Xe=Qe(()=>c("h1",{class:"border-bottom-1"},"Results",-1)),Ze={key:0},et=P({__name:"ResultsTable",props:{players:{},results:{}},setup(n){const t=n,e=a=>!a.finishTime||o(a)?null:a.scores.reduce((s,r)=>s.score>r.score?s:r).playerId,o=a=>{if(!a.finishTime)return!1;const h=a.scores.map(s=>s.score).reduce((s,r)=>Math.max(s,r));return a.scores.every(s=>s.score===h)},l=a=>!a.finishTime||o(a)?null:a.scores.reduce((s,r)=>s.score<r.score?s:r).playerId,i=(a,h)=>h.filter(s=>e(s)===a).length,u=(a,h)=>h.filter(s=>o(s)&&s.scores.some(r=>r.playerId===a)).length,d=(a,h)=>h.filter(s=>l(s)===a).length,f=(a,h)=>h.some(s=>s.scores.some(r=>r.playerId===a)&&!s.finishTime),p=(a,h,s)=>{const r=i(a,s),R=i(h,s);if(r!==R)return R-r;const $=d(a,s),N=d(h,s);return $!==N?N-$:0},k=F(()=>t.players.sort((a,h)=>p(a.id,h.id,t.results))),T=F(()=>k.value.map((a,h)=>({rank:h+1,name:a.name,wins:i(a.id,t.results),draws:u(a.id,t.results),losses:d(a.id,t.results),incomplete:f(a.id,t.results)}))),_=a=>[{"bg-primary":!a.incomplete&&a.rank===1,"bg-gray-400":a.incomplete}],y=T.value.filter(a=>a.incomplete).length;return(a,h)=>{const s=I("Column"),r=I("DataTable");return m(),b(B,null,[Xe,v(r,{value:T.value,rowClass:_},{default:M(()=>[v(s,{field:"rank",header:"#"}),v(s,{field:"name",header:"Name"}),v(s,{field:"wins",header:"Won"}),v(s,{field:"draws",header:"Drew"}),v(s,{field:"losses",header:"Lost"})]),_:1},8,["value"]),H(y)>0?(m(),b("h4",Ze,[c("em",null,S(H(y))+" player(s) have incomplete results!",1)])):E("",!0)],64)}}}),tt=K(et,[["__scopeId","data-v-93c0b17a"]]),st=n=>(X("data-v-e7024780"),n=n(),Z(),n),nt={key:0},ot={key:1},lt={class:"p-fluid mt-2"},at={key:2},rt={class:"p-fluid mt-2"},it=st(()=>c("footer",null,[c("a",{href:"https://www.flaticon.com/free-icons/ball-eight",title:"ball eight icons"},"Ball eight icons created by Boris farias - Flaticon")],-1)),ut=P({__name:"HomeView",setup(n){const t="Player 1;Player 2;Player 3;Player 4";let e=[];e=String(t).split(";"),e.length<10&&(e=[...e,...new Array(10-e.length).fill("")]);const o=x(0),l=x(e),i=x([]),u=x(0),d=x(0);let f;const p=x([]),k=F(()=>p.value.flatMap(C=>C.fixtures)),T=x("Fixtures"),_=x(!1),y=x(!1),a=C=>o.value=C,h=(C,U)=>{l.value=l.value.map((D,q)=>q===C?U:D)},s=(C,U,D)=>{i.value=C.map(q=>({id:ee(),name:q})),u.value=U,d.value=D,f=new J(i.value),p.value=f.generateFixtures(),a(1)},r=C=>{p.value=p.value.map(U=>U.startFixture(C))},R=(C,U)=>{p.value=p.value.map(D=>D.updateResult(C,U))},$=()=>{_.value=!0},N=()=>{a(2),g()},g=()=>{_.value=!1},V=()=>{y.value=!0},A=()=>{a(0),i.value=[],u.value=0,p.value=[]},te=()=>{y.value=!1};return(C,U)=>{const D=I("Button");return m(),b(B,null,[c("main",null,[o.value===0?(m(),b("div",nt,[v(Ke,{players:l.value,onSetName:h,onStart:s},null,8,["players"])])):o.value===1?(m(),b("div",ot,[T.value==="Fixtures"?(m(),L(Ve,{key:0,players:i.value,raceTo:u.value,currentRound:H(f).getCurrentRound(),rounds:p.value,onStart:r,onUpdateResult:R},null,8,["players","raceTo","currentRound","rounds"])):E("",!0),c("div",lt,[v(D,{label:"Finish",onClick:$})]),v(G,{visible:_.value,header:"Finish Flyer",message:"Are you ready to finish the flyer?",onConfirm:N,onCancel:g},null,8,["visible"])])):o.value===2?(m(),b("div",at,[v(tt,{players:i.value,results:k.value},null,8,["players","results"]),c("div",rt,[v(D,{label:"Restart",onClick:V})]),v(G,{visible:y.value,header:"Restart",message:"Are you sure you want to restart? All data for the current flyer will be lost!",onConfirm:A,onCancel:te},null,8,["visible"])])):E("",!0)]),it],64)}}}),mt=K(ut,[["__scopeId","data-v-e7024780"]]);export{mt as default};
