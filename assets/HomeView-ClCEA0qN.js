var se=Object.defineProperty;var ne=(s,t,e)=>t in s?se(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var L=(s,t,e)=>(ne(s,typeof t!="symbol"?t+"":t,e),e);import{d as B,r as g,w as H,c as P,a as k,b as $,o as p,e as c,t as I,f as _,g as y,n as z,h as Q,u as V,i as M,j as A,F as N,k as U,l as oe,m as le,p as X,q as Z}from"./index-B3bP5emF.js";const ae={class:"font-bold mb-2"},re={class:"p-fluid"},Y=B({__name:"ConfirmModal",props:{visible:{type:Boolean},header:{},message:{}},emits:["confirm","cancel"],setup(s,{emit:t}){const e=s,o=t,n=g(e.visible);return H(e,()=>{n.value=e.visible}),(r,a)=>{const m=$("Button"),u=$("Dialog");return p(),P(u,{visible:n.value,"onUpdate:visible":a[2]||(a[2]=h=>n.value=h),modal:"",header:e.header},{default:k(()=>[c("div",ae,I(e.message),1),c("div",re,[_(m,{class:"mb-2",type:"button",label:"Yes",onClick:a[0]||(a[0]=h=>o("confirm"))}),_(m,{type:"button",label:"No",severity:"secondary",onClick:a[1]||(a[1]=h=>o("cancel"))})])]),_:1},8,["visible","header"])}}}),ie={key:1},ue=B({__name:"ScoreCell",props:{result:{}},emits:["showResultModal"],setup(s,{emit:t}){const e=s,o=t,n=r=>r.finishTime?"bg-primary":r.startTime?"in-progress":"bg-cyan-100";return(r,a)=>(p(),y("div",{class:z(["p-2 text-center cursor-pointer border-round-md",n(e.result)]),onClick:a[0]||(a[0]=()=>o("showResultModal"))},[e.result.startTime?(p(),y("span",{key:0,class:z([e.result.finishTime&&"font-bold"])},I(e.result.scores.map(m=>m.score).join("-")),3)):(p(),y("span",ie," ?-? "))],2))}}),G=(s,t)=>{const e=s.__vccOpts||s;for(const[o,n]of t)e[o]=n;return e},ce=G(ue,[["__scopeId","data-v-a0880355"]]);let O;const de=new Uint8Array(16);function me(){if(!O&&(O=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!O))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return O(de)}const w=[];for(let s=0;s<256;++s)w.push((s+256).toString(16).slice(1));function pe(s,t=0){return w[s[t+0]]+w[s[t+1]]+w[s[t+2]]+w[s[t+3]]+"-"+w[s[t+4]]+w[s[t+5]]+"-"+w[s[t+6]]+w[s[t+7]]+"-"+w[s[t+8]]+w[s[t+9]]+"-"+w[s[t+10]]+w[s[t+11]]+w[s[t+12]]+w[s[t+13]]+w[s[t+14]]+w[s[t+15]]}const he=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),K={randomUUID:he};function ee(s,t,e){if(K.randomUUID&&!t&&!s)return K.randomUUID();s=s||{};const o=s.random||(s.rng||me)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,t){e=e||0;for(let n=0;n<16;++n)t[e+n]=o[n];return t}return pe(o)}const W=Q("players",()=>{const s=g([]);return{players:s,init:n=>{s.value=n.map(r=>({id:ee(),name:r}))},getName:n=>{var r;return((r=s.value.find(a=>a.id===n))==null?void 0:r.name)??n},clear:()=>s.value=[]}}),ve={class:"grid m-0"},fe={class:"col-5"},_e={class:"col-2 p-0"},be={class:"col-5 text-right"},ye=B({__name:"FixtureCard",props:{result:{}},emits:["showResultModal"],setup(s,{emit:t}){const e=s,o=t,n=W();return(r,a)=>(p(),y("div",ve,[c("div",fe,I(V(n).getName(e.result.scores[0].playerId)),1),c("div",_e,[_(ce,{result:e.result,onShowResultModal:a[0]||(a[0]=()=>o("showResultModal",e.result))},null,8,["result"])]),c("div",be,I(V(n).getName(e.result.scores[1].playerId)),1)]))}}),ge={class:"flex flex-column md:flex-row md:align-items-center justify-content-between mb-2"},xe={class:"font-bold"},Re={class:"flex flex-column md:flex-row md:align-items-center justify-content-between mb-2"},we={class:"font-bold"},Se={class:"md:ml-3"},Te=c("span",{class:"pi pi-plus"},null,-1),Ce=c("span",{class:"pi pi-minus"},null,-1),Fe={class:"p-fluid"},$e=B({__name:"RecordResultModal",props:{visible:{type:Boolean},currentRound:{},round:{},result:{},raceTo:{}},emits:["cancel","start","confirm"],setup(s,{emit:t}){const e=s,o=t,n=W(),r=g(e.visible),a=g(e.result.scores.map(i=>i.playerId)),m=g(e.result.scores.map(i=>i.score));H([m],()=>{var i;(i=document.activeElement)==null||i.blur()}),H(e,()=>{r.value=e.visible,a.value=e.result.scores.map(i=>i.playerId),m.value=e.result.scores.map(i=>i.score)});const u=(i,f)=>{m.value=m.value.map((T,F)=>F===i?f:T)},h=()=>o("start"),b=i=>{const f={id:e.result.id,scores:a.value.map((T,F)=>({playerId:T,score:m.value[F]})),startTime:e.result.startTime};o("confirm",f,i)},S=M(()=>e.round.index>e.currentRound?"Waiting for round to start":"Start"),R=M(()=>e.round.index>e.currentRound),l=M(()=>!!([...new Set(a.value)].length!==a.value.length||m.value.every(f=>f<e.raceTo))),v=M(()=>e.result.scores.map(i=>n.getName(i.playerId)).join(" v ")),d=M(()=>`${e.round.name} - ${v.value}`);return(i,f)=>{const T=$("InputNumber"),F=$("Button"),j=$("Dialog");return p(),P(j,{visible:r.value,"onUpdate:visible":f[3]||(f[3]=x=>r.value=x),modal:"",header:d.value},{default:k(()=>[e.result.finishTime?(p(!0),y(N,{key:0},A(a.value,(x,C)=>(p(),y("div",ge,[c("div",xe,I(V(n).getName(x))+": "+I(m.value[C]),1)]))),256)):e.result.startTime?(p(!0),y(N,{key:1},A(a.value,(x,C)=>(p(),y("div",Re,[c("div",we,I(V(n).getName(x)),1),c("div",Se,[_(T,{showButtons:"",buttonLayout:"horizontal",modelValue:m.value[C],min:0,max:e.raceTo,"onUpdate:modelValue":D=>u(C,D)},{incrementbuttonicon:k(()=>[Te]),decrementbuttonicon:k(()=>[Ce]),_:2},1032,["modelValue","max","onUpdate:modelValue"])])]))),256)):U("",!0),c("div",Fe,[e.result.startTime?U("",!0):(p(),P(F,{key:0,class:"mb-2",type:"button",label:S.value,disabled:R.value,onClick:h},null,8,["label","disabled"])),e.result.startTime&&!e.result.finishTime?(p(),P(F,{key:1,class:"mb-2",type:"button",label:"Update",severity:"info",onClick:f[0]||(f[0]=()=>b(!1))})):U("",!0),e.result.startTime&&!e.result.finishTime?(p(),P(F,{key:2,class:"mb-2",type:"button",label:"Finish",disabled:l.value,onClick:f[1]||(f[1]=()=>b(!0))},null,8,["disabled"])):U("",!0),_(F,{type:"button",label:"Close",severity:"secondary",onClick:f[2]||(f[2]=x=>o("cancel"))})])]),_:1},8,["visible","header"])}}}),J=Q("rounds",()=>{const s=g([]),t=M(()=>s.value.flatMap(u=>u.fixtures)),e=M(()=>s.value.flatMap(u=>u.fixtures).filter(u=>!u.finishTime).length),o=u=>s.value.find(h=>h.fixtures.some(b=>b.id===u)),n=u=>s.value=u;return{rounds:s,results:t,remainingCount:e,getRound:o,setRounds:n,startFixture:u=>{s.value=s.value.map(h=>h.startFixture(u))},updateResult:(u,h)=>{s.value=s.value.map(b=>b.updateResult(u,h))},clear:()=>n([])}}),Ie={class:"flex flex-column md:flex-row justify-content-between md:align-items-end border-bottom-1 pb-1"},ke=c("h1",null,"Fixtures",-1),Me={class:"text-center"},Ve=B({__name:"FixtureList",props:{raceTo:{},currentRound:{}},setup(s){const t=s,e=J(),o=M(()=>{var b;return e.getRound(((b=n.value)==null?void 0:b.id)||"")}),n=g(),r=g(!1),a=b=>{n.value=b,r.value=!0},m=()=>{n.value&&(e.startFixture(n.value.id),h())},u=(b,S)=>{e.updateResult(b,S),h()},h=()=>{r.value=!1};return(b,S)=>(p(),y(N,null,[c("div",Ie,[ke,c("h4",null,"Results remaining: "+I(V(e).remainingCount),1)]),(p(!0),y(N,null,A(V(e).rounds,(R,l)=>(p(),y("div",{class:z([l>0&&"border border-top-1"])},[c("h3",Me,I(R.name),1),(p(!0),y(N,null,A(R.fixtures,(v,d)=>(p(),y("div",{class:z(["mt-1 pt-1 mb-1",[d>0&&"border-gray-200 border-top-1"]])},[_(ye,{result:v,onShowResultModal:()=>a(v)},null,8,["result","onShowResultModal"])],2))),256))],2))),256)),o.value&&n.value?(p(),P($e,{key:0,visible:r.value,currentRound:t.currentRound,round:o.value,result:n.value,raceTo:t.raceTo,onStart:m,onConfirm:u,onCancel:h},null,8,["visible","currentRound","round","result","raceTo"])):U("",!0)],64))}}),Ne={class:"player-name-input p-fluid"},Be=B({__name:"PlayerNameInput",props:{name:{},placeholder:{},disabled:{type:Boolean}},emits:["setName"],setup(s,{emit:t}){const e=s,o=t;return(n,r)=>{const a=$("InputText");return p(),y("div",Ne,[_(a,{placeholder:e.placeholder,disabled:e.disabled,modelValue:e.name,"onUpdate:modelValue":r[0]||(r[0]=m=>o("setName",m||""))},null,8,["placeholder","disabled","modelValue"])])}}});class q{constructor(t){L(this,"frameTimeEstimateMins",7);L(this,"generatedRounds");this.players=t}estimateDuration(t,e,o){const n=t*(t-1)/2,r=2*e-1,a=(e+r)/2,m=n*a;return Math.ceil(this.frameTimeEstimateMins*m/o)}generateFixtures(){if(this.generatedRounds!==void 0)throw"Fixtures have already been generated!";let t=0;const e=this.players.length%2!==0,o=e?this.players.length:this.players.length-1;this.generatedRounds=[];const n=this.shuffle(this.players.map((a,m)=>m));let r=0;for(;r<o&&t<10;){const a=new De(r+1,"Round "+(r+1));console.log(a.name);let m=!1,u=[...this.players];for(e&&(console.log("Omitting: "+u[n[r]].name),u.splice(n[r],1));u.length>1;){const h=this.getRandom(u),b=this.generatedRounds.flatMap(l=>l.getExistingOpponents(h)),S=u.filter(l=>!b.includes(l.id)&&h.id!==l.id);if(S.length<=0){console.log("Retrying round..."),m=!0;break}const R=this.getRandom(S);a.addFixture([h,R]),u=u.filter(l=>![h.id,R.id].includes(l.id))}if(m){t++;continue}this.generatedRounds.push(a),r++}return t>=10&&console.log("Failed to generate rounds after 10 attempts!"),this.generatedRounds}getCurrentRound(){if(this.generatedRounds===void 0)return 0;const t=this.generatedRounds.find(e=>e.fixtures.some(o=>!o.finishTime));return t?t.index:0}getRandom(t){return t[Math.floor(Math.random()*t.length)]}shuffle(t){let e=t.length,o=0;for(;e>0;){o=Math.floor(Math.random()*e),e--;const n=t[e];t[e]=t[o],t[o]=n}return t}}class De{constructor(t,e){L(this,"index");L(this,"name");L(this,"fixtures");this.index=t,this.name=e,this.fixtures=[]}addFixture(t){console.log(t.map(e=>e.name).join(" v ")),this.fixtures.push({id:ee(),scores:t.map(e=>({playerId:e.id,score:0})),startTime:null,finishTime:null})}startFixture(t){const e=this.fixtures.findIndex(o=>o.id===t);return e>=0&&(this.fixtures[e].startTime=Date.now()),this}updateResult(t,e){const o=this.fixtures.findIndex(n=>n.id===t.id);return o>=0&&(e&&(t.finishTime=Date.now()),this.fixtures[o]=t),this}getExistingFixtures(t){return this.fixtures.filter(e=>e.scores.some(o=>o.playerId===t.id))}getExistingOpponents(t){const e=this.getExistingFixtures(t);return[...new Set(e.map(o=>o.scores.map(n=>n.playerId).filter(n=>n!==t.id)).flatMap(o=>o))]}}const Ue=c("h1",{class:"border-bottom-1 mb-2"},"Format",-1),Pe={class:"p-fluid mb-2"},Ee=c("span",{class:"pi pi-plus"},null,-1),Le=c("span",{class:"pi pi-minus"},null,-1),je={class:"p-fluid mb-2"},Ae=c("span",{class:"pi pi-plus"},null,-1),Oe=c("span",{class:"pi pi-minus"},null,-1),ze={class:"p-fluid mb-2"},We={class:"p-fluid mb-2"},He=c("h1",{class:"border-bottom-1 mb-2"},"Players",-1),Ye={class:"p-fluid mb-2"},qe=c("span",{class:"pi pi-plus"},null,-1),Ge=c("span",{class:"pi pi-minus"},null,-1),Je={class:"p-fluid"},Ke=B({__name:"FlyerForm",props:{players:{}},emits:["start","setName","reset"],setup(s,{emit:t}){const e=s,o=t,n=g(e.players.filter(i=>i).length),r=g("Round Robin"),a=g(["Round Robin"]),m=g(1),u=g(1),h=g(!1),b=M(()=>new q([]).estimateDuration(n.value,m.value,u.value)),S=new q([]).frameTimeEstimateMins;oe(()=>{const i=document.getElementsByClassName("p-inputnumber-button");for(const f of i)f.addEventListener("mouseup",()=>{var T;(T=document.activeElement)==null||T.blur()})});const R=M(()=>e.players.slice(0,n.value)),l=()=>{h.value=!0},v=()=>{o("start",R.value,m.value,u.value),d()},d=()=>{h.value=!1};return(i,f)=>{const T=$("InputNumber"),F=$("SelectButton"),j=$("Button");return p(),y(N,null,[Ue,c("div",Pe,[_(T,{modelValue:m.value,"onUpdate:modelValue":f[0]||(f[0]=x=>m.value=x),showButtons:"",buttonLayout:"horizontal",min:1,max:5,prefix:"Races to ",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:k(()=>[Ee]),decrementbuttonicon:k(()=>[Le]),_:1},8,["modelValue"])]),c("div",je,[_(T,{modelValue:u.value,"onUpdate:modelValue":f[1]||(f[1]=x=>u.value=x),showButtons:"",buttonLayout:"horizontal",min:1,max:Math.floor(n.value/2),suffix:" table(s)",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:k(()=>[Ae]),decrementbuttonicon:k(()=>[Oe]),_:1},8,["modelValue","max"])]),c("div",ze,[_(F,{modelValue:r.value,"onUpdate:modelValue":f[2]||(f[2]=x=>r.value=x),options:a.value,allowEmpty:!1,"aria-labelledby":"basic"},null,8,["modelValue","options"])]),c("div",We,[c("p",null,[le("Estimated duration: "+I(b.value)+" min(s) ",1),c("em",null,"("+I(V(S))+" min(s) per frame)",1)])]),He,c("div",Ye,[_(T,{modelValue:n.value,"onUpdate:modelValue":f[3]||(f[3]=x=>n.value=x),showButtons:"",buttonLayout:"horizontal",min:2,max:10,suffix:" players",inputStyle:{"text-align":"center","font-weight":"bold"}},{incrementbuttonicon:k(()=>[qe]),decrementbuttonicon:k(()=>[Ge]),_:1},8,["modelValue"])]),(p(!0),y(N,null,A(i.players,(x,C)=>(p(),y("div",null,[_(Be,{class:"mb-2",placeholder:"Player "+(C+1),disabled:C>=n.value,name:x,onSetName:D=>o("setName",C,D)},null,8,["placeholder","disabled","name","onSetName"])]))),256)),c("div",Je,[_(j,{label:"Start",disabled:R.value.some(x=>!x),onClick:l},null,8,["disabled"])]),_(Y,{visible:h.value,header:"Start Flyer",message:"Are you ready to start the flyer?",onConfirm:v,onCancel:d},null,8,["visible"])],64)}}}),Qe=s=>(X("data-v-9f0983d7"),s=s(),Z(),s),Xe=Qe(()=>c("h1",{class:"border-bottom-1"},"Results",-1)),Ze={key:0},et=B({__name:"ResultsTable",setup(s){const t=W(),e=J(),o=l=>!l.finishTime||n(l)?null:l.scores.reduce((d,i)=>d.score>i.score?d:i).playerId,n=l=>{if(!l.finishTime)return!1;const v=l.scores.map(d=>d.score).reduce((d,i)=>Math.max(d,i));return l.scores.every(d=>d.score===v)},r=l=>!l.finishTime||n(l)?null:l.scores.reduce((d,i)=>d.score<i.score?d:i).playerId,a=(l,v)=>v.filter(d=>o(d)===l).length,m=(l,v)=>v.filter(d=>n(d)&&d.scores.some(i=>i.playerId===l)).length,u=(l,v)=>v.filter(d=>r(d)===l).length,h=(l,v)=>v.some(d=>d.scores.some(i=>i.playerId===l)&&!d.finishTime),b=M(()=>t.players.map((l,v)=>({rank:v+1,name:l.name,wins:a(l.id,e.results),draws:m(l.id,e.results),losses:u(l.id,e.results),incomplete:h(l.id,e.results)})).sort((l,v)=>l.wins!==v.wins?v.wins-l.wins:l.losses!==v.losses?v.losses-l.losses:0)),S=l=>[{"bg-primary":!l.incomplete&&l.rank===1,"bg-gray-400":l.incomplete}],R=b.value.filter(l=>l.incomplete).length;return(l,v)=>{const d=$("Column"),i=$("DataTable");return p(),y(N,null,[Xe,_(i,{value:b.value,rowClass:S},{default:k(()=>[_(d,{field:"rank",header:"#"}),_(d,{field:"name",header:"Name"}),_(d,{field:"wins",header:"Won"}),_(d,{field:"draws",header:"Drew"}),_(d,{field:"losses",header:"Lost"})]),_:1},8,["value"]),V(R)>0?(p(),y("h4",Ze,[c("em",null,I(V(R))+" player(s) have incomplete results!",1)])):U("",!0)],64)}}}),tt=G(et,[["__scopeId","data-v-9f0983d7"]]),st=s=>(X("data-v-5bfc530a"),s=s(),Z(),s),nt={key:0},ot={key:1},lt={class:"p-fluid mt-2"},at={key:2},rt={class:"p-fluid mt-2"},it=st(()=>c("footer",null,[c("a",{href:"https://www.flaticon.com/free-icons/ball-eight",title:"ball eight icons"},"Ball eight icons created by Boris farias - Flaticon")],-1)),ut=B({__name:"HomeView",setup(s){const t="Player 1;Player 2;Player 3;Player 4";let e=[];e=String(t).split(";"),e.length<10&&(e=[...e,...new Array(10-e.length).fill("")]);const o=g(0),n=g(e),r=W(),a=g(0),m=g(0);let u;const h=J(),b=g("Fixtures"),S=g(!1),R=g(!1),l=C=>o.value=C,v=(C,D)=>{n.value=n.value.map((E,te)=>te===C?D:E)},d=(C,D,E)=>{r.init(C),a.value=D,m.value=E,u=new q(r.players),h.setRounds(u.generateFixtures()),l(1)},i=()=>{S.value=!0},f=()=>{l(2),T()},T=()=>{S.value=!1},F=()=>{R.value=!0},j=()=>{l(0),r.clear(),a.value=0,h.clear()},x=()=>{R.value=!1};return(C,D)=>{const E=$("Button");return p(),y(N,null,[c("main",null,[o.value===0?(p(),y("div",nt,[_(Ke,{players:n.value,onSetName:v,onStart:d},null,8,["players"])])):o.value===1?(p(),y("div",ot,[b.value==="Fixtures"?(p(),P(Ve,{key:0,raceTo:a.value,currentRound:V(u).getCurrentRound()},null,8,["raceTo","currentRound"])):U("",!0),c("div",lt,[_(E,{label:"Finish",onClick:i})]),_(Y,{visible:S.value,header:"Finish Flyer",message:"Are you ready to finish the flyer?",onConfirm:f,onCancel:T},null,8,["visible"])])):o.value===2?(p(),y("div",at,[_(tt),c("div",rt,[_(E,{label:"Restart",onClick:F})]),_(Y,{visible:R.value,header:"Restart",message:"Are you sure you want to restart? All data for the current flyer will be lost!",onConfirm:j,onCancel:x},null,8,["visible"])])):U("",!0)]),it],64)}}}),mt=G(ut,[["__scopeId","data-v-5bfc530a"]]);export{mt as default};
