var Z=Object.defineProperty;var ee=(e,t,n)=>t in e?Z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var j=(e,t,n)=>(ee(e,typeof t!="symbol"?t+"":t,n),n);import{d as te,i as B,l as k,q as ne,w as oe,r as J,o as re,f as z,t as se,a as K,u as ie,e as ae,s as Y,v as le,x as ue,y as ce,z as de,A as fe,B as Q,b as D}from"./index-DkA9jdjo.js";const pe={class:"font-bold mb-2"},me={class:"p-fluid"},Ke=te({__name:"ConfirmModal",props:{visible:{type:Boolean},header:{},message:{}},emits:["confirm","hide"],setup(e,{emit:t}){const n=e,o=t,s=B(n.visible);return k(n,()=>{s.value=n.visible}),(c,u)=>{const f=J("Button"),y=J("Dialog");return re(),ne(y,{visible:s.value,"onUpdate:visible":u[2]||(u[2]=d=>s.value=d),modal:"",header:n.header,onHide:u[3]||(u[3]=d=>o("hide"))},{default:oe(()=>[z("div",pe,se(n.message),1),z("div",me,[K(f,{class:"mb-2",type:"button",label:"Yes",onClick:u[0]||(u[0]=d=>o("confirm"))}),K(f,{type:"button",label:"No",severity:"secondary",onClick:u[1]||(u[1]=d=>o("hide"))})])]),_:1},8,["visible","header"])}}});function ge(e){return ue()?(ce(e),!0):!1}function V(e){return typeof e=="function"?e():ie(e)}const ye=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const he=Object.prototype.toString,ve=e=>he.call(e)==="[object Object]",we=()=>{};function be(e,t){function n(...o){return new Promise((s,c)=>{Promise.resolve(e(()=>t.apply(this,o),{fn:t,thisArg:this,args:o})).then(s).catch(c)})}return n}const X=e=>e();function xe(e=X){const t=B(!0);function n(){t.value=!1}function o(){t.value=!0}const s=(...c)=>{t.value&&e(...c)};return{isActive:le(t),pause:n,resume:o,eventFilter:s}}function Se(e){return e||de()}function Re(e,t,n={}){const{eventFilter:o=X,...s}=n;return k(e,be(o,t),s)}function Te(e,t,n={}){const{eventFilter:o,...s}=n,{eventFilter:c,pause:u,resume:f,isActive:y}=xe(o);return{stop:Re(e,t,{...s,eventFilter:c}),pause:u,resume:f,isActive:y}}function De(e,t=!0,n){Se()?ae(e,n):t?e():Y(e)}function Ie(e){var t;const n=V(e);return(t=n==null?void 0:n.$el)!=null?t:n}const W=ye?window:void 0;function H(...e){let t,n,o,s;if(typeof e[0]=="string"||Array.isArray(e[0])?([n,o,s]=e,t=W):[t,n,o,s]=e,!t)return we;Array.isArray(n)||(n=[n]),Array.isArray(o)||(o=[o]);const c=[],u=()=>{c.forEach(m=>m()),c.length=0},f=(m,g,x,w)=>(m.addEventListener(g,x,w),()=>m.removeEventListener(g,x,w)),y=k(()=>[Ie(t),V(s)],([m,g])=>{if(u(),!m)return;const x=ve(g)?{...g}:g;c.push(...n.flatMap(w=>o.map(b=>f(m,w,b,x))))},{immediate:!0,flush:"post"}),d=()=>{y(),u()};return ge(d),d}const A=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},E="__vueuse_ssr_handlers__",Fe=Me();function Me(){return E in A||(A[E]=A[E]||{}),A[E]}function Ce(e,t){return Fe[e]||t}function Oe(e){return e==null?"any":e instanceof Set?"set":e instanceof Map?"map":e instanceof Date?"date":typeof e=="boolean"?"boolean":typeof e=="string"?"string":typeof e=="object"?"object":Number.isNaN(e)?"any":"number"}const Ne={boolean:{read:e=>e==="true",write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}},L="vueuse-storage";function M(e,t,n,o={}){var s;const{flush:c="pre",deep:u=!0,listenToStorageChanges:f=!0,writeDefaults:y=!0,mergeDefaults:d=!1,shallow:m,window:g=W,eventFilter:x,onError:w=l=>{console.error(l)},initOnMounted:b}=o,S=(m?fe:B)(typeof t=="function"?t():t);if(!n)try{n=Ce("getDefaultStorage",()=>{var l;return(l=W)==null?void 0:l.localStorage})()}catch(l){w(l)}if(!n)return S;const R=V(t),_=Oe(R),p=(s=o.serializer)!=null?s:Ne[_],{pause:r,resume:a}=Te(S,()=>i(S.value),{flush:c,deep:u,eventFilter:x});return g&&f&&De(()=>{H(g,"storage",F),H(g,L,I),b&&F()}),b||F(),S;function i(l){try{const T=n.getItem(e),C=N=>{g&&g.dispatchEvent(new CustomEvent(L,{detail:{key:e,oldValue:T,newValue:N,storageArea:n}}))};if(l==null)C(null),n.removeItem(e);else{const N=p.write(l);T!==N&&(n.setItem(e,N),C(N))}}catch(T){w(T)}}function v(l){const T=l?l.newValue:n.getItem(e);if(T==null)return y&&R!=null&&n.setItem(e,p.write(R)),R;if(!l&&d){const C=p.read(T);return typeof d=="function"?d(C,R):_==="object"&&!Array.isArray(C)?{...R,...C}:C}else return typeof T!="string"?T:p.read(T)}function I(l){F(l.detail)}function F(l){if(!(l&&l.storageArea!==n)){if(l&&l.key==null){S.value=R;return}if(!(l&&l.key!==e)){r();try{(l==null?void 0:l.newValue)!==p.write(S.value)&&(S.value=v(l))}catch(T){w(T)}finally{l?Y(a):a()}}}}}let P;const _e=new Uint8Array(16);function Ae(){if(!P&&(P=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!P))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return P(_e)}const h=[];for(let e=0;e<256;++e)h.push((e+256).toString(16).slice(1));function Ee(e,t=0){return h[e[t+0]]+h[e[t+1]]+h[e[t+2]]+h[e[t+3]]+"-"+h[e[t+4]]+h[e[t+5]]+"-"+h[e[t+6]]+h[e[t+7]]+"-"+h[e[t+8]]+h[e[t+9]]+"-"+h[e[t+10]]+h[e[t+11]]+h[e[t+12]]+h[e[t+13]]+h[e[t+14]]+h[e[t+15]]}const Pe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),$={randomUUID:Pe};function U(e,t,n){if($.randomUUID&&!t&&!e)return $.randomUUID();e=e||{};const o=e.random||(e.rng||Ae)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,t){n=n||0;for(let s=0;s<16;++s)t[n+s]=o[s];return t}return Ee(o)}class q{constructor(){j(this,"frameTimeEstimateMins",7);j(this,"generatedRounds")}estimateDuration(t,n,o){const s=t*(t-1)/2,c=2*n-1,u=(n+c)/2,f=s*u;return Math.ceil(this.frameTimeEstimateMins*f/o)}generateFixtures(t){if(this.generatedRounds!==void 0)throw"Fixtures have already been generated!";let n=0;const o=t.length%2!==0,s=o?t.length:t.length-1;this.generatedRounds=[];const c=this.shuffle(t.map((f,y)=>y));let u=0;for(;u<s&&n<10;){const f={index:u+1,name:"Round "+(u+1),fixtures:[]};console.log(f.name);let y=!1,d=[...t];for(o&&(console.log("Omitting: "+d[c[u]].name),d.splice(c[u],1));d.length>1;){const m=this.getRandom(d),g=this.generatedRounds.flatMap(b=>this.getExistingOpponents(b,m)),x=d.filter(b=>!g.includes(b.id)&&m.id!==b.id);if(x.length<=0){console.log("Retrying round..."),y=!0;break}const w=this.getRandom(x);this.addFixture(f,[m,w],[]),d=d.filter(b=>![m.id,w.id].includes(b.id))}if(y){n++;continue}this.generatedRounds.push(f),u++}return n>=10&&console.log("Failed to generate rounds after 10 attempts!"),this.generatedRounds}addFixture(t,n,o){console.log(n.map(s=>s.name).join(" v ")),t.fixtures.push({id:U(),parentFixtureIds:o,scores:n.map(s=>({playerId:s.id,score:0,isBye:!1})),startTime:null,finishTime:null})}getExistingOpponents(t,n){const o=t.fixtures.filter(s=>s.scores.some(c=>c.playerId===n.id));return[...new Set(o.map(s=>s.scores.map(c=>c.playerId).filter(c=>c!==n.id)).flatMap(s=>s))]}getCurrentRound(){if(this.generatedRounds===void 0)return 0;const t=this.generatedRounds.find(n=>n.fixtures.some(o=>!o.finishTime));return t?t.index:0}getRandom(t){return t[Math.floor(Math.random()*t.length)]}shuffle(t){let n=t.length,o=0;for(;n>0;){o=Math.floor(Math.random()*n),n--;const s=t[n];t[n]=t[o],t[o]=s}return t}}var ke=(e=>(e.Knockout="Knockout",e.RoundRobin="Round Robin",e))(ke||{});const je="Player 1;Player 2;Player 3;Player 4";let O=[];O=String(je).split(";");O.length<10&&(O=[...O,...new Array(10-O.length).fill("")]);const He=Q("settings",()=>{const e=M("playerCount",O.filter(p=>p).length),t=M("playerNames",O),n=M("raceTo",1),o=M("tableCount",1),s=M("format","Knockout"),c=["Knockout","Round Robin"],u=M("requireCompletedRounds",!0),f=M("allowEarlyFinish",!1);k(s,()=>{s.value==="Knockout"&&(u.value=!0,f.value=!1)});const y=D(()=>t.value.slice(0,e.value)),d=D(()=>new q().estimateDuration(e.value,n.value,o.value)),m=D(()=>new q().frameTimeEstimateMins),g=D(()=>y.value.some(p=>!p)),x=p=>e.value=p,w=p=>t.value=p,b=(p,r)=>{t.value=t.value.map((a,i)=>i===p?r:a)},S=p=>n.value=p,R=p=>o.value=p;return{playerNames:t,raceTo:n,tableCount:o,format:s,formatOptions:c,requireCompletedRounds:u,allowEarlyFinish:f,playerCount:e,estimatedDuration:d,durationPerFrame:m,actualPlayers:y,isInvalid:g,setPlayerCount:x,setPlayers:w,setName:b,setRaceTo:S,setTableCount:R,reset:()=>{S(1),R(1)}}});function G(e){const t=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&t==="[object Date]"?new e.constructor(+e):typeof e=="number"||t==="[object Number]"||typeof e=="string"||t==="[object String]"?new Date(e):new Date(NaN)}const We=6e4;function Ue(e){return t=>{const o=(e?Math[e]:Math.trunc)(t);return o===0?0:o}}function Be(e,t){return+G(e)-+G(t)}function Ve(e,t,n){const o=Be(e,t)/We;return Ue(n==null?void 0:n.roundingMethod)(o)}const Le=Q("flyer",()=>{const e=M("flyer",null,localStorage,{serializer:{read:r=>JSON.parse(r),write:r=>JSON.stringify(r)}}),t=D(()=>{var r;return((r=e.value)==null?void 0:r.players)??[]}),n=D(()=>{var r;return((r=e.value)==null?void 0:r.rounds)??[]}),o=D(()=>n.value.flatMap(r=>r.fixtures)),s=D(()=>o.value.filter(r=>r.startTime&&!r.finishTime).length),c=D(()=>o.value.filter(r=>!r.finishTime).length),u=D(()=>{const r=n.value.find(a=>a.fixtures.some(i=>!i.finishTime));return r?r.index:0}),f=D(()=>{var r,a;return!((r=e.value)!=null&&r.startTime)||!((a=e.value)!=null&&a.finishTime)?null:Ve(new Date(e.value.finishTime),new Date(e.value.startTime))}),y=D(()=>{const r=n.value[n.value.length-1];if(r){const a=r.fixtures[r.fixtures.length-1];return S(a).playerId}return""}),d=r=>n.value.find(a=>a.fixtures.some(i=>i.id===r)),m=r=>{var a;return((a=t.value.find(i=>i.id===r))==null?void 0:a.name)??r},g=(r,a)=>{const i=r.map(v=>({id:U(),name:v}));e.value={id:U(),players:i,startTime:null,finishTime:null,rounds:a.generateFixtures(i)},e.value.startTime=Date.now();for(const v of e.value.rounds){const I=x(v);for(const[F,l]of I)R(F,l)}},x=r=>{const a=[];for(let i of r.fixtures)if(i.scores.some(I=>I.isBye)){console.log("Walking over "+i.id);const I=Date.now();i.startTime=I,i.finishTime=I;const F=i.scores.find(l=>!l.isBye&&l.playerId);if(!F)throw"No winner of walkover "+i.id+"!";a.push([i.id,F.playerId])}return a},w=r=>{for(const a of e.value.rounds){const i=a.fixtures.findIndex(v=>v.id===r);i>=0&&(a.fixtures[i].startTime=Date.now())}},b=(r,a)=>{for(const i of e.value.rounds){const v=i.fixtures.findIndex(I=>I.id===r.id);v>=0&&(a&&(r.finishTime=Date.now(),R(r.id,S(r).playerId)),i.fixtures[v]=r)}},S=r=>r.scores.reduce((a,i)=>a.score>i.score?a:i),R=(r,a)=>{for(const i of e.value.rounds.flatMap(v=>v.fixtures)){const v=i.parentFixtureIds.indexOf(r);v>=0&&(i.scores[v].playerId=a)}};return{players:t,rounds:n,results:o,ongoingCount:s,remainingCount:c,currentRound:u,durationMinutes:f,winner:y,getRound:d,getPlayerName:m,start:g,startFixture:w,updateResult:b,finish:()=>{e.value&&(e.value.finishTime=Date.now())},clear:()=>e.value=null}}),$e=(e,t)=>{const n=e.__vccOpts||e;for(const[o,s]of t)n[o]=s;return n};export{ke as F,q as R,Ke as _,Le as a,$e as b,Ve as d,He as u,U as v};
